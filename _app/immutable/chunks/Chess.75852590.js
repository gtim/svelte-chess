var ln=Object.defineProperty;var un=(e,t,n)=>t in e?ln(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var D=(e,t,n)=>(un(e,typeof t!="symbol"?t+"":t,n),n);import{S as je,i as Qe,s as He,k as ge,l as pe,m as me,h as z,n as G,b as Ee,H as Ce,o as wt,w as Re,U as fn,a as dn,c as hn,X as tt,p as ke,G as nt,J as ot,K as gn,y as pn,z as mn,A as bn,g as _n,d as vn,B as wn,Y as kn}from"./index.18b0dfda.js";const Sn=["white","black"],Ue=["a","b","c","d","e","f","g","h"],We=["1","2","3","4","5","6","7","8"],Cn=[...We].reverse(),Je=Array.prototype.concat(...Ue.map(e=>We.map(t=>e+t))),B=e=>Je[8*e[0]+e[1]],M=e=>[e.charCodeAt(0)-97,e.charCodeAt(1)-49],kt=Je.map(M);function yn(e){let t;const n=()=>(t===void 0&&(t=e()),t);return n.clear=()=>{t=void 0},n}const Pn=()=>{let e;return{start(){e=performance.now()},cancel(){e=void 0},stop(){if(!e)return 0;const t=performance.now()-e;return e=void 0,t}}},Ge=e=>e==="white"?"black":"white",be=(e,t)=>{const n=e[0]-t[0],o=e[1]-t[1];return n*n+o*o},Ke=(e,t)=>e.role===t.role&&e.color===t.color,ve=e=>(t,n)=>[(n?t[0]:7-t[0])*e.width/8,(n?7-t[1]:t[1])*e.height/8],J=(e,t)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px)`},St=(e,t,n=1)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px) scale(${n})`},Ve=(e,t)=>{e.style.visibility=t?"visible":"hidden"},ae=e=>{var t;if(e.clientX||e.clientX===0)return[e.clientX,e.clientY];if(!((t=e.targetTouches)===null||t===void 0)&&t[0])return[e.targetTouches[0].clientX,e.targetTouches[0].clientY]},Ct=e=>e.buttons===2||e.button===2,V=(e,t)=>{const n=document.createElement(e);return t&&(n.className=t),n};function yt(e,t,n){const o=M(e);return t||(o[0]=7-o[0],o[1]=7-o[1]),[n.left+n.width*o[0]/8+n.width/16,n.top+n.height*(7-o[1])/8+n.height/16]}const ce=(e,t)=>Math.abs(e-t),En=e=>(t,n,o,i)=>ce(t,o)<2&&(e==="white"?i===n+1||n<=1&&i===n+2&&t===o:i===n-1||n>=6&&i===n-2&&t===o),Pt=(e,t,n,o)=>{const i=ce(e,n),r=ce(t,o);return i===1&&r===2||i===2&&r===1},Et=(e,t,n,o)=>ce(e,n)===ce(t,o),Mt=(e,t,n,o)=>e===n||t===o,At=(e,t,n,o)=>Et(e,t,n,o)||Mt(e,t,n,o),Mn=(e,t,n)=>(o,i,r,c)=>ce(o,r)<2&&ce(i,c)<2||n&&i===c&&i===(e==="white"?0:7)&&(o===4&&(r===2&&t.includes(0)||r===6&&t.includes(7))||t.includes(r));function An(e,t){const n=t==="white"?"1":"8",o=[];for(const[i,r]of e)i[1]===n&&r.color===t&&r.role==="rook"&&o.push(M(i)[0]);return o}function Tt(e,t,n){const o=e.get(t);if(!o)return[];const i=M(t),r=o.role,c=r==="pawn"?En(o.color):r==="knight"?Pt:r==="bishop"?Et:r==="rook"?Mt:r==="queen"?At:Mn(o.color,An(e,o.color),n);return kt.filter(s=>(i[0]!==s[0]||i[1]!==s[1])&&c(i[0],i[1],s[0],s[1])).map(B)}function q(e,...t){e&&setTimeout(()=>e(...t),1)}function Tn(e){e.orientation=Ge(e.orientation),e.animation.current=e.draggable.current=e.selected=void 0}function Nn(e,t){for(const[n,o]of t)o?e.pieces.set(n,o):e.pieces.delete(n)}function On(e,t){if(e.check=void 0,t===!0&&(t=e.turnColor),t)for(const[n,o]of e.pieces)o.role==="king"&&o.color===t&&(e.check=n)}function In(e,t,n,o){oe(e),e.premovable.current=[t,n],q(e.premovable.events.set,t,n,o)}function ne(e){e.premovable.current&&(e.premovable.current=void 0,q(e.premovable.events.unset))}function qn(e,t,n){ne(e),e.predroppable.current={role:t,key:n},q(e.predroppable.events.set,t,n)}function oe(e){const t=e.predroppable;t.current&&(t.current=void 0,q(t.events.unset))}function xn(e,t,n){if(!e.autoCastle)return!1;const o=e.pieces.get(t);if(!o||o.role!=="king")return!1;const i=M(t),r=M(n);if(i[1]!==0&&i[1]!==7||i[1]!==r[1])return!1;i[0]===4&&!e.pieces.has(n)&&(r[0]===6?n=B([7,r[1]]):r[0]===2&&(n=B([0,r[1]])));const c=e.pieces.get(n);return!c||c.color!==o.color||c.role!=="rook"?!1:(e.pieces.delete(t),e.pieces.delete(n),i[0]<r[0]?(e.pieces.set(B([6,r[1]]),o),e.pieces.set(B([5,r[1]]),c)):(e.pieces.set(B([2,r[1]]),o),e.pieces.set(B([3,r[1]]),c)),!0)}function Nt(e,t,n){const o=e.pieces.get(t),i=e.pieces.get(n);if(t===n||!o)return!1;const r=i&&i.color!==o.color?i:void 0;return n===e.selected&&Q(e),q(e.events.move,t,n,r),xn(e,t,n)||(e.pieces.set(n,o),e.pieces.delete(t)),e.lastMove=[t,n],e.check=void 0,q(e.events.change),r||!0}function ze(e,t,n,o){if(e.pieces.has(n))if(o)e.pieces.delete(n);else return!1;return q(e.events.dropNewPiece,t,n),e.pieces.set(n,t),e.lastMove=[n],e.check=void 0,q(e.events.change),e.movable.dests=void 0,e.turnColor=Ge(e.turnColor),!0}function Ot(e,t,n){const o=Nt(e,t,n);return o&&(e.movable.dests=void 0,e.turnColor=Ge(e.turnColor),e.animation.current=void 0),o}function It(e,t,n){if(Ze(e,t,n)){const o=Ot(e,t,n);if(o){const i=e.hold.stop();Q(e);const r={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:i};return o!==!0&&(r.captured=o),q(e.movable.events.after,t,n,r),!0}}else if(Rn(e,t,n))return In(e,t,n,{ctrlKey:e.stats.ctrlKey}),Q(e),!0;return Q(e),!1}function qt(e,t,n,o){const i=e.pieces.get(t);i&&(Dn(e,t,n)||o)?(e.pieces.delete(t),ze(e,i,n,o),q(e.movable.events.afterNewPiece,i.role,n,{premove:!1,predrop:!1})):i&&Kn(e,t,n)?qn(e,i.role,n):(ne(e),oe(e)),e.pieces.delete(t),Q(e)}function Le(e,t,n){if(q(e.events.select,t),e.selected){if(e.selected===t&&!e.draggable.enabled){Q(e),e.hold.cancel();return}else if((e.selectable.enabled||n)&&e.selected!==t&&It(e,e.selected,t)){e.stats.dragged=!1;return}}(e.selectable.enabled||e.draggable.enabled)&&(Dt(e,t)||Ye(e,t))&&(xt(e,t),e.hold.start())}function xt(e,t){e.selected=t,Ye(e,t)?e.premovable.dests=Tt(e.pieces,t,e.premovable.castle):e.premovable.dests=void 0}function Q(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function Dt(e,t){const n=e.pieces.get(t);return!!n&&(e.movable.color==="both"||e.movable.color===n.color&&e.turnColor===n.color)}const Ze=(e,t,n)=>{var o,i;return t!==n&&Dt(e,t)&&(e.movable.free||!!(!((i=(o=e.movable.dests)===null||o===void 0?void 0:o.get(t))===null||i===void 0)&&i.includes(n)))};function Dn(e,t,n){const o=e.pieces.get(t);return!!o&&(t===n||!e.pieces.has(n))&&(e.movable.color==="both"||e.movable.color===o.color&&e.turnColor===o.color)}function Ye(e,t){const n=e.pieces.get(t);return!!n&&e.premovable.enabled&&e.movable.color===n.color&&e.turnColor!==n.color}const Rn=(e,t,n)=>t!==n&&Ye(e,t)&&Tt(e.pieces,t,e.premovable.castle).includes(n);function Kn(e,t,n){const o=e.pieces.get(t),i=e.pieces.get(n);return!!o&&(!i||i.color!==e.movable.color)&&e.predroppable.enabled&&(o.role!=="pawn"||n[1]!=="1"&&n[1]!=="8")&&e.movable.color===o.color&&e.turnColor!==o.color}function Ln(e,t){const n=e.pieces.get(t);return!!n&&e.draggable.enabled&&(e.movable.color==="both"||e.movable.color===n.color&&(e.turnColor===n.color||e.premovable.enabled))}function Fn(e){const t=e.premovable.current;if(!t)return!1;const n=t[0],o=t[1];let i=!1;if(Ze(e,n,o)){const r=Ot(e,n,o);if(r){const c={premove:!0};r!==!0&&(c.captured=r),q(e.movable.events.after,n,o,c),i=!0}}return ne(e),i}function Bn(e,t){const n=e.predroppable.current;let o=!1;if(!n)return!1;if(t(n)){const i={role:n.role,color:e.movable.color};ze(e,i,n.key)&&(q(e.movable.events.afterNewPiece,n.role,n.key,{premove:!1,predrop:!0}),o=!0)}return oe(e),o}function Xe(e){ne(e),oe(e),Q(e)}function it(e){e.movable.color=e.movable.dests=e.animation.current=void 0,Xe(e)}function le(e,t,n){let o=Math.floor(8*(e[0]-n.left)/n.width);t||(o=7-o);let i=7-Math.floor(8*(e[1]-n.top)/n.height);return t||(i=7-i),o>=0&&o<8&&i>=0&&i<8?B([o,i]):void 0}function jn(e,t,n,o){const i=M(e),r=kt.filter(l=>At(i[0],i[1],l[0],l[1])||Pt(i[0],i[1],l[0],l[1])),s=r.map(l=>yt(B(l),n,o)).map(l=>be(t,l)),[,a]=s.reduce((l,g,h)=>l[0]<g?l:[g,h],[s[0],0]);return B(r[a])}const x=e=>e.orientation==="white",Rt="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",Qn={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},Hn={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};function Kt(e){e==="start"&&(e=Rt);const t=new Map;let n=7,o=0;for(const i of e)switch(i){case" ":case"[":return t;case"/":if(--n,n<0)return t;o=0;break;case"~":{const r=t.get(B([o-1,n]));r&&(r.promoted=!0);break}default:{const r=i.charCodeAt(0);if(r<57)o+=r-48;else{const c=i.toLowerCase();t.set(B([o,n]),{role:Qn[c],color:i===c?"black":"white"}),++o}}}return t}function Un(e){return Cn.map(t=>Ue.map(n=>{const o=e.get(n+t);if(o){let i=Hn[o.role];return o.color==="white"&&(i=i.toUpperCase()),o.promoted&&(i+="~"),i}else return"1"}).join("")).join("/").replace(/1{2,}/g,t=>t.length.toString())}function Lt(e,t){t.animation&&($e(e.animation,t.animation),(e.animation.duration||0)<70&&(e.animation.enabled=!1))}function Ft(e,t){var n,o,i;if(!((n=t.movable)===null||n===void 0)&&n.dests&&(e.movable.dests=void 0),!((o=t.drawable)===null||o===void 0)&&o.autoShapes&&(e.drawable.autoShapes=[]),$e(e,t),t.fen&&(e.pieces=Kt(t.fen),e.drawable.shapes=((i=t.drawable)===null||i===void 0?void 0:i.shapes)||[]),"check"in t&&On(e,t.check||!1),"lastMove"in t&&!t.lastMove?e.lastMove=void 0:t.lastMove&&(e.lastMove=t.lastMove),e.selected&&xt(e,e.selected),Lt(e,t),!e.movable.rookCastle&&e.movable.dests){const r=e.movable.color==="white"?"1":"8",c="e"+r,s=e.movable.dests.get(c),a=e.pieces.get(c);if(!s||!a||a.role!=="king")return;e.movable.dests.set(c,s.filter(l=>!(l==="a"+r&&s.includes("c"+r))&&!(l==="h"+r&&s.includes("g"+r))))}}function $e(e,t){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(Object.prototype.hasOwnProperty.call(e,n)&&rt(e[n])&&rt(t[n])?$e(e[n],t[n]):e[n]=t[n])}function rt(e){if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return t===Object.prototype||t===null}const re=(e,t)=>t.animation.enabled?Gn(e,t):$(e,t);function $(e,t){const n=e(t);return t.dom.redraw(),n}const Ne=(e,t)=>({key:e,pos:M(e),piece:t}),Wn=(e,t)=>t.sort((n,o)=>be(e.pos,n.pos)-be(e.pos,o.pos))[0];function Jn(e,t){const n=new Map,o=[],i=new Map,r=[],c=[],s=new Map;let a,l,g;for(const[h,f]of e)s.set(h,Ne(h,f));for(const h of Je)a=t.pieces.get(h),l=s.get(h),a?l?Ke(a,l.piece)||(r.push(l),c.push(Ne(h,a))):c.push(Ne(h,a)):l&&r.push(l);for(const h of c)l=Wn(h,r.filter(f=>Ke(h.piece,f.piece))),l&&(g=[l.pos[0]-h.pos[0],l.pos[1]-h.pos[1]],n.set(h.key,g.concat(g)),o.push(l.key));for(const h of r)o.includes(h.key)||i.set(h.key,h.piece);return{anims:n,fadings:i}}function Bt(e,t){const n=e.animation.current;if(n===void 0){e.dom.destroyed||e.dom.redrawNow();return}const o=1-(t-n.start)*n.frequency;if(o<=0)e.animation.current=void 0,e.dom.redrawNow();else{const i=Vn(o);for(const r of n.plan.anims.values())r[2]=r[0]*i,r[3]=r[1]*i;e.dom.redrawNow(!0),requestAnimationFrame((r=performance.now())=>Bt(e,r))}}function Gn(e,t){const n=new Map(t.pieces),o=e(t),i=Jn(n,t);if(i.anims.size||i.fadings.size){const r=t.animation.current&&t.animation.current.start;t.animation.current={start:performance.now(),frequency:1/t.animation.duration,plan:i},r||Bt(t,performance.now())}else t.dom.redraw();return o}const Vn=e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,zn=["green","red","blue","yellow"];function Zn(e,t){if(t.touches&&t.touches.length>1)return;t.stopPropagation(),t.preventDefault(),t.ctrlKey?Q(e):Xe(e);const n=ae(t),o=le(n,x(e),e.dom.bounds());o&&(e.drawable.current={orig:o,pos:n,brush:eo(t),snapToValidMove:e.drawable.defaultSnapToValidMove},jt(e))}function jt(e){requestAnimationFrame(()=>{const t=e.drawable.current;if(t){const n=le(t.pos,x(e),e.dom.bounds());n||(t.snapToValidMove=!1);const o=t.snapToValidMove?jn(t.orig,t.pos,x(e),e.dom.bounds()):n;o!==t.mouseSq&&(t.mouseSq=o,t.dest=o!==t.orig?o:void 0,e.dom.redrawNow()),jt(e)}})}function Yn(e,t){e.drawable.current&&(e.drawable.current.pos=ae(t))}function Xn(e){const t=e.drawable.current;t&&(t.mouseSq&&to(e.drawable,t),Qt(e))}function Qt(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function $n(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.dom.redraw(),Ht(e.drawable))}function eo(e){var t;const n=(e.shiftKey||e.ctrlKey)&&Ct(e),o=e.altKey||e.metaKey||((t=e.getModifierState)===null||t===void 0?void 0:t.call(e,"AltGraph"));return zn[(n?1:0)+(o?2:0)]}function to(e,t){const n=i=>i.orig===t.orig&&i.dest===t.dest,o=e.shapes.find(n);o&&(e.shapes=e.shapes.filter(i=>!n(i))),(!o||o.brush!==t.brush)&&e.shapes.push({orig:t.orig,dest:t.dest,brush:t.brush}),Ht(e)}function Ht(e){e.onChange&&e.onChange(e.shapes)}function no(e,t){if(!t.isTrusted||t.button!==void 0&&t.button!==0||t.touches&&t.touches.length>1)return;const n=e.dom.bounds(),o=ae(t),i=le(o,x(e),n);if(!i)return;const r=e.pieces.get(i),c=e.selected;!c&&e.drawable.enabled&&(e.drawable.eraseOnClick||!r||r.color!==e.turnColor)&&$n(e),t.cancelable!==!1&&(!t.touches||e.blockTouchScroll||r||c||oo(e,o))&&t.preventDefault();const s=!!e.premovable.current,a=!!e.predroppable.current;e.stats.ctrlKey=t.ctrlKey,e.selected&&Ze(e,e.selected,i)?re(h=>Le(h,i),e):Le(e,i);const l=e.selected===i,g=Wt(e,i);if(r&&g&&l&&Ln(e,i)){e.draggable.current={orig:i,piece:r,origPos:o,pos:o,started:e.draggable.autoDistance&&e.stats.dragged,element:g,previouslySelected:c,originTarget:t.target,keyHasChanged:!1},g.cgDragging=!0,g.classList.add("dragging");const h=e.dom.elements.ghost;h&&(h.className=`ghost ${r.color} ${r.role}`,J(h,ve(n)(M(i),x(e))),Ve(h,!0)),et(e)}else s&&ne(e),a&&oe(e);e.dom.redraw()}function oo(e,t){const n=x(e),o=e.dom.bounds(),i=Math.pow(o.width/8,2);for(const r of e.pieces.keys()){const c=yt(r,n,o);if(be(c,t)<=i)return!0}return!1}function io(e,t,n,o){const i="a0";e.pieces.set(i,t),e.dom.redraw();const r=ae(n);e.draggable.current={orig:i,piece:t,origPos:r,pos:r,started:!0,element:()=>Wt(e,i),originTarget:n.target,newPiece:!0,force:!!o,keyHasChanged:!1},et(e)}function et(e){requestAnimationFrame(()=>{var t;const n=e.draggable.current;if(!n)return;!((t=e.animation.current)===null||t===void 0)&&t.plan.anims.has(n.orig)&&(e.animation.current=void 0);const o=e.pieces.get(n.orig);if(!o||!Ke(o,n.piece))ye(e);else if(!n.started&&be(n.pos,n.origPos)>=Math.pow(e.draggable.distance,2)&&(n.started=!0),n.started){if(typeof n.element=="function"){const r=n.element();if(!r)return;r.cgDragging=!0,r.classList.add("dragging"),n.element=r}const i=e.dom.bounds();J(n.element,[n.pos[0]-i.left-i.width/16,n.pos[1]-i.top-i.height/16]),n.keyHasChanged||(n.keyHasChanged=n.orig!==le(n.pos,x(e),i))}et(e)})}function ro(e,t){e.draggable.current&&(!t.touches||t.touches.length<2)&&(e.draggable.current.pos=ae(t))}function so(e,t){const n=e.draggable.current;if(!n)return;if(t.type==="touchend"&&t.cancelable!==!1&&t.preventDefault(),t.type==="touchend"&&n.originTarget!==t.target&&!n.newPiece){e.draggable.current=void 0;return}ne(e),oe(e);const o=ae(t)||n.pos,i=le(o,x(e),e.dom.bounds());i&&n.started&&n.orig!==i?n.newPiece?qt(e,n.orig,i,n.force):(e.stats.ctrlKey=t.ctrlKey,It(e,n.orig,i)&&(e.stats.dragged=!0)):n.newPiece?e.pieces.delete(n.orig):e.draggable.deleteOnDropOff&&!i&&(e.pieces.delete(n.orig),q(e.events.change)),(n.orig===n.previouslySelected||n.keyHasChanged)&&(n.orig===i||!i)?Q(e):e.selectable.enabled||Q(e),Ut(e),e.draggable.current=void 0,e.dom.redraw()}function ye(e){const t=e.draggable.current;t&&(t.newPiece&&e.pieces.delete(t.orig),e.draggable.current=void 0,Q(e),Ut(e),e.dom.redraw())}function Ut(e){const t=e.dom.elements;t.ghost&&Ve(t.ghost,!1)}function Wt(e,t){let n=e.dom.elements.board.firstChild;for(;n;){if(n.cgKey===t&&n.tagName==="PIECE")return n;n=n.nextSibling}}function co(e,t){e.exploding={stage:1,keys:t},e.dom.redraw(),setTimeout(()=>{st(e,2),setTimeout(()=>st(e,void 0),120)},120)}function st(e,t){e.exploding&&(t?e.exploding.stage=t:e.exploding=void 0,e.dom.redraw())}function ao(e,t){function n(){Tn(e),t()}return{set(o){o.orientation&&o.orientation!==e.orientation&&n(),Lt(e,o),(o.fen?re:$)(i=>Ft(i,o),e)},state:e,getFen:()=>Un(e.pieces),toggleOrientation:n,setPieces(o){re(i=>Nn(i,o),e)},selectSquare(o,i){o?re(r=>Le(r,o,i),e):e.selected&&(Q(e),e.dom.redraw())},move(o,i){re(r=>Nt(r,o,i),e)},newPiece(o,i){re(r=>ze(r,o,i),e)},playPremove(){if(e.premovable.current){if(re(Fn,e))return!0;e.dom.redraw()}return!1},playPredrop(o){if(e.predroppable.current){const i=Bn(e,o);return e.dom.redraw(),i}return!1},cancelPremove(){$(ne,e)},cancelPredrop(){$(oe,e)},cancelMove(){$(o=>{Xe(o),ye(o)},e)},stop(){$(o=>{it(o),ye(o)},e)},explode(o){co(e,o)},setAutoShapes(o){$(i=>i.drawable.autoShapes=o,e)},setShapes(o){$(i=>i.drawable.shapes=o,e)},getKeyAtDomPos(o){return le(o,x(e),e.dom.bounds())},redrawAll:t,dragNewPiece(o,i,r){io(e,o,i,r)},destroy(){it(e),e.dom.unbind&&e.dom.unbind(),e.dom.destroyed=!0}}}function lo(){return{pieces:Kt(Rt),orientation:"white",turnColor:"white",coordinates:!0,ranksPosition:"right",autoCastle:!0,viewOnly:!1,disableContextMenu:!1,addPieceZIndex:!1,blockTouchScroll:!1,pieceKey:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15}},prevSvgHash:""},hold:Pn()}}function Fe(e,t,n){const o=new Map,i=[];for(const s of e)o.set(s.hash,!1);let r=t.firstChild,c;for(;r;)c=r.getAttribute("cgHash"),o.has(c)?o.set(c,!0):i.push(r),r=r.nextSibling;for(const s of i)t.removeChild(s);for(const s of e)o.get(s.hash)||t.appendChild(n(s))}function j(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function uo(e,t,n){const o=e.drawable,i=o.current,r=i&&i.mouseSq?i:void 0,c=new Map,s=e.dom.bounds(),a=o.autoShapes.filter(u=>!u.piece);for(const u of o.shapes.concat(a).concat(r?[r]:[]))u.dest&&c.set(u.dest,(c.get(u.dest)||0)+1);const l=o.shapes.concat(a).map(u=>({shape:u,current:!1,hash:ct(u,c,!1,s)}));r&&l.push({shape:r,current:!0,hash:ct(r,c,!0,s)});const g=l.map(u=>u.hash).join(";");if(g===e.drawable.prevSvgHash)return;e.drawable.prevSvgHash=g;const h=t.querySelector("defs"),f=t.querySelector("g"),k=n.querySelector("g");fo(o,l,h),Fe(l.filter(u=>!u.shape.customSvg),f,u=>at(e,u,o.brushes,c,s)),Fe(l.filter(u=>u.shape.customSvg),k,u=>at(e,u,o.brushes,c,s))}function fo(e,t,n){var o;const i=new Map;let r;for(const a of t)a.shape.dest&&(r=e.brushes[a.shape.brush],a.shape.modifiers&&(r=Jt(r,a.shape.modifiers)),!((o=a.shape.modifiers)===null||o===void 0)&&o.hilite&&i.set("hilite",{key:"hilite",color:"white",opacity:1,lineWidth:1}),i.set(r.key,r));const c=new Set;let s=n.firstChild;for(;s;)c.add(s.getAttribute("cgKey")),s=s.nextSibling;for(const[a,l]of i.entries())c.has(a)||n.appendChild(vo(l))}function ct({orig:e,dest:t,brush:n,piece:o,modifiers:i,customSvg:r},c,s,a){return[a.width,a.height,s,e,t,n,t&&(c.get(t)||0)>1,o&&ho(o),i&&go(i),r&&po(r)].filter(l=>l).join(",")}function ho(e){return[e.color,e.role,e.scale].filter(t=>t).join(",")}function go(e){return[e.lineWidth,e.hilite].filter(t=>t).join(",")}function po(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n)>>>0;return"custom-"+t.toString()}function at(e,{shape:t,current:n,hash:o},i,r,c){var s;let a;const l=lt(M(t.orig),e.orientation);if(t.customSvg)a=mo(t.customSvg,l,c);else if(t.dest&&t.dest!=t.orig){let g=i[t.brush];t.modifiers&&(g=Jt(g,t.modifiers)),a=_o(g,l,lt(M(t.dest),e.orientation),n,(r.get(t.dest)||0)>1,c,(s=t.modifiers)===null||s===void 0?void 0:s.hilite)}else a=bo(i[t.brush],l,n,c);return a.setAttribute("cgHash",o),a}function mo(e,t,n){const[o,i]=Pe(t,n),r=te(j("g"),{transform:`translate(${o},${i})`}),c=te(j("svg"),{width:1,height:1,viewBox:"0 0 100 100"});return r.appendChild(c),c.innerHTML=e,r}function bo(e,t,n,o){const i=Pe(t,o),r=wo(),c=(o.width+o.height)/(4*Math.max(o.width,o.height));return te(j("circle"),{stroke:e.color,"stroke-width":r[n?0:1],fill:"none",opacity:Gt(e,n),cx:i[0],cy:i[1],r:c-r[1]/2})}function _o(e,t,n,o,i,r,c=!1){function s(l){const g=So(i&&!o),h=Pe(t,r),f=Pe(n,r),k=f[0]-h[0],u=f[1]-h[1],d=Math.atan2(u,k),w=Math.cos(d)*g,m=Math.sin(d)*g;return te(j("line"),{stroke:l?"white":e.color,"stroke-width":ko(e,o)+(l?.04:0),"stroke-linecap":"round","marker-end":`url(#arrowhead-${l?"hilite":e.key})`,opacity:l?1:Gt(e,o),x1:h[0],y1:h[1],x2:f[0]-w,y2:f[1]-m})}const a=c?j("g"):s(!1);return c&&[!0,!1].map(l=>a.appendChild(s(l))),a}function vo(e){const t=te(j("marker"),{id:"arrowhead-"+e.key,orient:"auto",markerWidth:4,markerHeight:8,refX:e.key==="hilite"?1.86:2.05,refY:2});return t.appendChild(te(j("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),t.setAttribute("cgKey",e.key),t}function te(e,t){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.setAttribute(n,t[n]);return e}function lt(e,t){return t==="white"?e:[7-e[0],7-e[1]]}function Jt(e,t){return{color:e.color,opacity:Math.round(e.opacity*10)/10,lineWidth:Math.round(t.lineWidth||e.lineWidth),key:[e.key,t.lineWidth].filter(n=>n).join("")}}function wo(){return[3/64,4/64]}function ko(e,t){return(e.lineWidth||10)*(t?.85:1)/64}function Gt(e,t){return(e.opacity||1)*(t?.9:1)}function So(e){return(e?20:10)/64}function Pe(e,t){const n=Math.min(1,t.width/t.height),o=Math.min(1,t.height/t.width);return[(e[0]-3.5)*n,(3.5-e[1])*o]}function Co(e,t){e.innerHTML="",e.classList.add("cg-wrap");for(const a of Sn)e.classList.toggle("orientation-"+a,t.orientation===a);e.classList.toggle("manipulable",!t.viewOnly);const n=V("cg-container");e.appendChild(n);const o=V("cg-board");n.appendChild(o);let i,r,c;if(t.drawable.visible&&(i=te(j("svg"),{class:"cg-shapes",viewBox:"-4 -4 8 8",preserveAspectRatio:"xMidYMid slice"}),i.appendChild(j("defs")),i.appendChild(j("g")),r=te(j("svg"),{class:"cg-custom-svgs",viewBox:"-3.5 -3.5 8 8",preserveAspectRatio:"xMidYMid slice"}),r.appendChild(j("g")),c=V("cg-auto-pieces"),n.appendChild(i),n.appendChild(r),n.appendChild(c)),t.coordinates){const a=t.orientation==="black"?" black":"",l=t.ranksPosition==="left"?" left":"";n.appendChild(ut(We,"ranks"+a+l)),n.appendChild(ut(Ue,"files"+a))}let s;return t.draggable.enabled&&t.draggable.showGhost&&(s=V("piece","ghost"),Ve(s,!1),n.appendChild(s)),{board:o,container:n,wrap:e,ghost:s,svg:i,customSvg:r,autoPieces:c}}function ut(e,t){const n=V("coords",t);let o;for(const i of e)o=V("coord"),o.textContent=i,n.appendChild(o);return n}function yo(e,t){if(!e.dropmode.active)return;ne(e),oe(e);const n=e.dropmode.piece;if(n){e.pieces.set("a0",n);const o=ae(t),i=o&&le(o,x(e),e.dom.bounds());i&&qt(e,"a0",i)}e.dom.redraw()}function Po(e,t){const n=e.dom.elements.board;if("ResizeObserver"in window&&new ResizeObserver(t).observe(e.dom.elements.wrap),(e.disableContextMenu||e.drawable.enabled)&&n.addEventListener("contextmenu",i=>i.preventDefault()),e.viewOnly)return;const o=Mo(e);n.addEventListener("touchstart",o,{passive:!1}),n.addEventListener("mousedown",o,{passive:!1})}function Eo(e,t){const n=[];if("ResizeObserver"in window||n.push(ue(document.body,"chessground.resize",t)),!e.viewOnly){const o=ft(e,ro,Yn),i=ft(e,so,Xn);for(const c of["touchmove","mousemove"])n.push(ue(document,c,o));for(const c of["touchend","mouseup"])n.push(ue(document,c,i));const r=()=>e.dom.bounds.clear();n.push(ue(document,"scroll",r,{capture:!0,passive:!0})),n.push(ue(window,"resize",r,{passive:!0}))}return()=>n.forEach(o=>o())}function ue(e,t,n,o){return e.addEventListener(t,n,o),()=>e.removeEventListener(t,n,o)}const Mo=e=>t=>{e.draggable.current?ye(e):e.drawable.current?Qt(e):t.shiftKey||Ct(t)?e.drawable.enabled&&Zn(e,t):e.viewOnly||(e.dropmode.active?yo(e,t):no(e,t))},ft=(e,t,n)=>o=>{e.drawable.current?e.drawable.enabled&&n(e,o):e.viewOnly||t(e,o)};function Ao(e){const t=x(e),n=ve(e.dom.bounds()),o=e.dom.elements.board,i=e.pieces,r=e.animation.current,c=r?r.plan.anims:new Map,s=r?r.plan.fadings:new Map,a=e.draggable.current,l=No(e),g=new Set,h=new Set,f=new Map,k=new Map;let u,d,w,m,P,p,C,E,H,U;for(d=o.firstChild;d;){if(u=d.cgKey,Vt(d))if(w=i.get(u),P=c.get(u),p=s.get(u),m=d.cgPiece,d.cgDragging&&(!a||a.orig!==u)&&(d.classList.remove("dragging"),J(d,n(M(u),t)),d.cgDragging=!1),!p&&d.cgFading&&(d.cgFading=!1,d.classList.remove("fading")),w){if(P&&d.cgAnimating&&m===fe(w)){const y=M(u);y[0]+=P[2],y[1]+=P[3],d.classList.add("anim"),J(d,n(y,t))}else d.cgAnimating&&(d.cgAnimating=!1,d.classList.remove("anim"),J(d,n(M(u),t)),e.addPieceZIndex&&(d.style.zIndex=Oe(M(u),t)));m===fe(w)&&(!p||!d.cgFading)?g.add(u):p&&m===fe(p)?(d.classList.add("fading"),d.cgFading=!0):Ie(f,m,d)}else Ie(f,m,d);else if(zt(d)){const y=d.className;l.get(u)===y?h.add(u):Ie(k,y,d)}d=d.nextSibling}for(const[y,L]of l)if(!h.has(y)){H=k.get(L),U=H&&H.pop();const O=n(M(y),t);if(U)U.cgKey=y,J(U,O);else{const I=V("square",L);I.cgKey=y,J(I,O),o.insertBefore(I,o.firstChild)}}for(const[y,L]of i)if(P=c.get(y),!g.has(y))if(C=f.get(fe(L)),E=C&&C.pop(),E){E.cgKey=y,E.cgFading&&(E.classList.remove("fading"),E.cgFading=!1);const O=M(y);e.addPieceZIndex&&(E.style.zIndex=Oe(O,t)),P&&(E.cgAnimating=!0,E.classList.add("anim"),O[0]+=P[2],O[1]+=P[3]),J(E,n(O,t))}else{const O=fe(L),I=V("piece",O),_=M(y);I.cgPiece=O,I.cgKey=y,P&&(I.cgAnimating=!0,_[0]+=P[2],_[1]+=P[3]),J(I,n(_,t)),e.addPieceZIndex&&(I.style.zIndex=Oe(_,t)),o.appendChild(I)}for(const y of f.values())ht(e,y);for(const y of k.values())ht(e,y)}function To(e){const t=x(e),n=ve(e.dom.bounds());let o=e.dom.elements.board.firstChild;for(;o;)(Vt(o)&&!o.cgAnimating||zt(o))&&J(o,n(M(o.cgKey),t)),o=o.nextSibling}function dt(e){var t,n;const o=e.dom.elements.wrap.getBoundingClientRect(),i=e.dom.elements.container,r=o.height/o.width,c=Math.floor(o.width*window.devicePixelRatio/8)*8/window.devicePixelRatio,s=c*r;i.style.width=c+"px",i.style.height=s+"px",e.dom.bounds.clear(),(t=e.addDimensionsCssVarsTo)===null||t===void 0||t.style.setProperty("--cg-width",c+"px"),(n=e.addDimensionsCssVarsTo)===null||n===void 0||n.style.setProperty("--cg-height",s+"px")}const Vt=e=>e.tagName==="PIECE",zt=e=>e.tagName==="SQUARE";function ht(e,t){for(const n of t)e.dom.elements.board.removeChild(n)}function Oe(e,t){const o=e[1];return`${t?3+7-o:3+o}`}const fe=e=>`${e.color} ${e.role}`;function No(e){var t;const n=new Map;if(e.lastMove&&e.highlight.lastMove)for(const r of e.lastMove)Z(n,r,"last-move");if(e.check&&e.highlight.check&&Z(n,e.check,"check"),e.selected&&(Z(n,e.selected,"selected"),e.movable.showDests)){const r=(t=e.movable.dests)===null||t===void 0?void 0:t.get(e.selected);if(r)for(const s of r)Z(n,s,"move-dest"+(e.pieces.has(s)?" oc":""));const c=e.premovable.dests;if(c)for(const s of c)Z(n,s,"premove-dest"+(e.pieces.has(s)?" oc":""))}const o=e.premovable.current;if(o)for(const r of o)Z(n,r,"current-premove");else e.predroppable.current&&Z(n,e.predroppable.current.key,"current-premove");const i=e.exploding;if(i)for(const r of i.keys)Z(n,r,"exploding"+i.stage);return n}function Z(e,t,n){const o=e.get(t);o?e.set(t,`${o} ${n}`):e.set(t,n)}function Ie(e,t,n){const o=e.get(t);o?o.push(n):e.set(t,[n])}function Oo(e,t){const o=e.drawable.autoShapes.filter(i=>i.piece).map(i=>({shape:i,hash:xo(i),current:!1}));Fe(o,t,i=>qo(e,i,e.dom.bounds()))}function Io(e){var t;const n=x(e),o=ve(e.dom.bounds());let i=(t=e.dom.elements.autoPieces)===null||t===void 0?void 0:t.firstChild;for(;i;)St(i,o(M(i.cgKey),n),i.cgScale),i=i.nextSibling}function qo(e,{shape:t,hash:n},o){var i,r,c;const s=t.orig,a=(i=t.piece)===null||i===void 0?void 0:i.role,l=(r=t.piece)===null||r===void 0?void 0:r.color,g=(c=t.piece)===null||c===void 0?void 0:c.scale,h=V("piece",`${a} ${l}`);return h.setAttribute("cgHash",n),h.cgKey=s,h.cgScale=g,St(h,ve(o)(M(s),x(e)),g),h}const xo=e=>{var t,n,o;return[e.orig,(t=e.piece)===null||t===void 0?void 0:t.role,(n=e.piece)===null||n===void 0?void 0:n.color,(o=e.piece)===null||o===void 0?void 0:o.scale].join(",")};function Do(e,t){const n=lo();Ft(n,t||{});function o(){const i="dom"in n?n.dom.unbind:void 0,r=Co(e,n),c=yn(()=>r.board.getBoundingClientRect()),s=g=>{Ao(l),r.autoPieces&&Oo(l,r.autoPieces),!g&&r.svg&&uo(l,r.svg,r.customSvg)},a=()=>{dt(l),To(l),r.autoPieces&&Io(l)},l=n;return l.dom={elements:r,bounds:c,redraw:Ro(s),redrawNow:s,unbind:i},l.drawable.prevSvgHash="",dt(l),s(!1),Po(l,a),i||(l.dom.unbind=Eo(l,a)),l.events.insert&&l.events.insert(r),l}return ao(o(),o)}function Ro(e){let t=!1;return()=>{t||(t=!0,requestAnimationFrame(()=>{e(),t=!1}))}}function Ko(e){let t,n;return{c(){t=ge("div"),this.h()},l(o){t=pe(o,"DIV",{class:!0}),me(t).forEach(z),this.h()},h(){G(t,"class",n="cg-wrap "+e[0]+" svelte-d0p6kd")},m(o,i){Ee(o,t,i),e[36](t)},p(o,i){i[0]&1&&n!==(n="cg-wrap "+o[0]+" svelte-d0p6kd")&&G(t,"class",n)},i:Ce,o:Ce,d(o){o&&z(t),e[36](null)}}}function Lo(e,t,n){let{className:o="cg-default-style"}=t,{fen:i=void 0}=t,{orientation:r=void 0}=t,{turnColor:c=void 0}=t,{check:s=void 0}=t,{lastMove:a=void 0}=t,{selected:l=void 0}=t,{coordinates:g=void 0}=t,{autoCastle:h=void 0}=t,{viewOnly:f=void 0}=t,{disableContextMenu:k=void 0}=t,{addPieceZIndex:u=void 0}=t,{addDimensionsCssVarsTo:d=void 0}=t,{blockTouchScroll:w=void 0}=t,{config:m={}}=t,P,p;wt(async()=>{r!==void 0&&n(2,m.orientation=r,m),i!==void 0&&n(2,m.fen=i,m),c!==void 0&&n(2,m.turnColor=c,m),s!==void 0&&n(2,m.check=s,m),a!==void 0&&n(2,m.lastMove=a,m),l!==void 0&&n(2,m.selected=l,m),g!==void 0&&n(2,m.coordinates=g,m),h!==void 0&&n(2,m.autoCastle=h,m),f!==void 0&&n(2,m.viewOnly=f,m),k!==void 0&&n(2,m.disableContextMenu=k,m),u!==void 0&&n(2,m.addPieceZIndex=u,m),d!==void 0&&n(2,m.addDimensionsCssVarsTo=d,m),w!==void 0&&n(2,m.blockTouchScroll=w,m),p=Do(P,m)});function C(b){p&&p.set(b)}function E(b){p.set(b)}function H(){return p.state}function U(){return p.getFen()}function y(){return p.toggleOrientation()}function L(b,ie){return p.move(b,ie)}function O(b){return p.setPieces(b)}function I(b,ie){return p.selectSquare(b,ie)}function _(b,ie){return p.newPiece(b,ie)}function Me(){return p.playPremove()}function Ae(){p.cancelPremove()}function Te(b){return p.playPredrop(b)}function Yt(){p.cancelPredrop()}function Xt(){p.cancelMove()}function $t(){p.stop()}function en(b){p.explode(b)}function tn(b){p.setShapes(b)}function nn(b){p.setAutoShapes(b)}function on(){return p.redrawAll()}function rn(b,ie,an){p.dragNewPiece(b,ie,an)}function sn(){return p.destroy()}function cn(b){Re[b?"unshift":"push"](()=>{P=b,n(1,P)})}return e.$$set=b=>{"className"in b&&n(0,o=b.className),"fen"in b&&n(3,i=b.fen),"orientation"in b&&n(4,r=b.orientation),"turnColor"in b&&n(5,c=b.turnColor),"check"in b&&n(6,s=b.check),"lastMove"in b&&n(7,a=b.lastMove),"selected"in b&&n(8,l=b.selected),"coordinates"in b&&n(9,g=b.coordinates),"autoCastle"in b&&n(10,h=b.autoCastle),"viewOnly"in b&&n(11,f=b.viewOnly),"disableContextMenu"in b&&n(12,k=b.disableContextMenu),"addPieceZIndex"in b&&n(13,u=b.addPieceZIndex),"addDimensionsCssVarsTo"in b&&n(14,d=b.addDimensionsCssVarsTo),"blockTouchScroll"in b&&n(15,w=b.blockTouchScroll),"config"in b&&n(2,m=b.config)},e.$$.update=()=>{e.$$.dirty[0]&8&&C({fen:i}),e.$$.dirty[0]&16&&C({orientation:r}),e.$$.dirty[0]&32&&C({turnColor:c}),e.$$.dirty[0]&64&&C({check:s}),e.$$.dirty[0]&128&&C({lastMove:a}),e.$$.dirty[0]&256&&C({selected:l}),e.$$.dirty[0]&512&&C({coordinates:g}),e.$$.dirty[0]&1024&&C({autoCastle:h}),e.$$.dirty[0]&2048&&C({viewOnly:f}),e.$$.dirty[0]&4096&&C({disableContextMenu:k}),e.$$.dirty[0]&8192&&C({addPieceZIndex:u}),e.$$.dirty[0]&16384&&C({addDimensionsCssVarsTo:d}),e.$$.dirty[0]&32768&&C({blockTouchScroll:w}),e.$$.dirty[0]&4&&C(m)},[o,P,m,i,r,c,s,a,l,g,h,f,k,u,d,w,E,H,U,y,L,O,I,_,Me,Ae,Te,Yt,Xt,$t,en,tn,nn,on,rn,sn,cn]}class Fo extends je{constructor(t){super(),Qe(this,t,Lo,Ko,He,{className:0,fen:3,orientation:4,turnColor:5,check:6,lastMove:7,selected:8,coordinates:9,autoCastle:10,viewOnly:11,disableContextMenu:12,addPieceZIndex:13,addDimensionsCssVarsTo:14,blockTouchScroll:15,config:2,set:16,getState:17,getFen:18,toggleOrientation:19,move:20,setPieces:21,selectSquare:22,newPiece:23,playPremove:24,cancelPremove:25,playPredrop:26,cancelPredrop:27,cancelMove:28,stop:29,explode:30,setShapes:31,setAutoShapes:32,redrawAll:33,dragNewPiece:34,destroy:35},null,[-1,-1])}get set(){return this.$$.ctx[16]}get getState(){return this.$$.ctx[17]}get getFen(){return this.$$.ctx[18]}get toggleOrientation(){return this.$$.ctx[19]}get move(){return this.$$.ctx[20]}get setPieces(){return this.$$.ctx[21]}get selectSquare(){return this.$$.ctx[22]}get newPiece(){return this.$$.ctx[23]}get playPremove(){return this.$$.ctx[24]}get cancelPremove(){return this.$$.ctx[25]}get playPredrop(){return this.$$.ctx[26]}get cancelPredrop(){return this.$$.ctx[27]}get cancelMove(){return this.$$.ctx[28]}get stop(){return this.$$.ctx[29]}get explode(){return this.$$.ctx[30]}get setShapes(){return this.$$.ctx[31]}get setAutoShapes(){return this.$$.ctx[32]}get redrawAll(){return this.$$.ctx[33]}get dragNewPiece(){return this.$$.ctx[34]}get destroy(){return this.$$.ctx[35]}}function gt(e,t,n){const o=e.slice();o[12]=t[n],o[16]=n;const i=o[4]&&o[0]==="w"||o[5]&&o[0]==="b";o[13]=i;const r=o[13]?o[16]*12.5:100-12.5*(o[16]+1);return o[14]=r,o}function pt(e){let t,n,o,i,r;function c(){return e[10](e[12])}function s(...a){return e[11](e[12],...a)}return{c(){t=ge("div"),n=ge("div"),o=dn(),this.h()},l(a){t=pe(a,"DIV",{class:!0,style:!0});var l=me(t);n=pe(l,"DIV",{class:!0,role:!0,tabindex:!0,"aria-label":!0}),me(n).forEach(z),o=hn(l),l.forEach(z),this.h()},h(){G(n,"class","piece "+e[12]+" svelte-1692twp"),G(n,"role","button"),G(n,"tabindex","0"),G(n,"aria-label","Promote to "+e[7][e[12]]),tt(n,"white",e[4]),tt(n,"black",e[5]),G(t,"class","square svelte-1692twp"),ke(t,"margin-left",e[3]+"%"),ke(t,"margin-top",e[14]+"%")},m(a,l){Ee(a,t,l),nt(t,n),nt(t,o),i||(r=[ot(n,"click",c),ot(n,"keydown",s)],i=!0)},p(a,l){e=a,l&1&&ke(t,"margin-top",e[14]+"%")},d(a){a&&z(t),i=!1,gn(r)}}}function Bo(e){let t,n,o=e[6],i=[];for(let r=0;r<o.length;r+=1)i[r]=pt(gt(e,o,r));return{c(){t=ge("div");for(let r=0;r<i.length;r+=1)i[r].c();this.h()},l(r){t=pe(r,"DIV",{class:!0});var c=me(t);for(let s=0;s<i.length;s+=1)i[s].l(c);c.forEach(z),this.h()},h(){G(t,"class",n="dialog "+e[2]+" svelte-1692twp")},m(r,c){Ee(r,t,c);for(let s=0;s<i.length;s+=1)i[s]&&i[s].m(t,null)},p(r,[c]){if(c&507){o=r[6];let s;for(s=0;s<o.length;s+=1){const a=gt(r,o,s);i[s]?i[s].p(a,c):(i[s]=pt(a),i[s].c(),i[s].m(t,null))}for(;s<i.length;s+=1)i[s].d(1);i.length=o.length}c&4&&n!==(n="dialog "+r[2]+" svelte-1692twp")&&G(t,"class",n)},i:Ce,o:Ce,d(r){r&&z(t),fn(i,r)}}}function mt(e){return e.charCodeAt(0)-97}function jo(e,t,n){let{square:o}=t,{orientation:i="w"}=t,{callback:r}=t,{class:c=void 0}=t;const s=100/8*(i==="w"?mt(o):7-mt(o)),a=o.charAt(1)==="8",l=!a,g=["q","n","r","b"],h={q:"queen",n:"knight",r:"rook",b:"bishop",p:"pawn",k:"king"};function f(d,w){(d.key==="Enter"||d.key===" ")&&r(w)}const k=d=>r(d),u=(d,w)=>f(w,d);return e.$$set=d=>{"square"in d&&n(9,o=d.square),"orientation"in d&&n(0,i=d.orientation),"callback"in d&&n(1,r=d.callback),"class"in d&&n(2,c=d.class)},[i,r,c,s,a,l,g,h,f,o,k,u]}class Qo extends je{constructor(t){super(),Qe(this,t,jo,Bo,He,{square:9,orientation:0,callback:1,class:2})}}/**
 * @license
 * Copyright (c) 2023, Jeff Hlywa (jhlywa@gmail.com)
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice,
 *    this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 * POSSIBILITY OF SUCH DAMAGE.
 */const N="w",F="b",A="p",Be="n",Se="b",he="r",ee="q",T="k",qe="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",R=-1,Ho={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},Uo=["a8","b8","c8","d8","e8","f8","g8","h8","a7","b7","c7","d7","e7","f7","g7","h7","a6","b6","c6","d6","e6","f6","g6","h6","a5","b5","c5","d5","e5","f5","g5","h5","a4","b4","c4","d4","e4","f4","g4","h4","a3","b3","c3","d3","e3","f3","g3","h3","a2","b2","c2","d2","e2","f2","g2","h2","a1","b1","c1","d1","e1","f1","g1","h1"],v={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},S={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},xe={b:[16,32,17,15],w:[-16,-32,-17,-15]},bt={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},Wo=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],Jo=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],Go={p:1,n:2,b:4,r:8,q:16,k:32},Vo="pnbrqkPNBRQK",_t=[Be,Se,he,ee],zo=7,Zo=6,Yo=1,Xo=0,we={[T]:v.KSIDE_CASTLE,[ee]:v.QSIDE_CASTLE},Y={w:[{square:S.a1,flag:v.QSIDE_CASTLE},{square:S.h1,flag:v.KSIDE_CASTLE}],b:[{square:S.a8,flag:v.QSIDE_CASTLE},{square:S.h8,flag:v.KSIDE_CASTLE}]},$o={b:Yo,w:Zo},ei=["1-0","0-1","1/2-1/2","*"];function se(e){return e>>4}function _e(e){return e&15}function Zt(e){return"0123456789".indexOf(e)!==-1}function K(e){const t=_e(e),n=se(e);return"abcdefgh".substring(t,t+1)+"87654321".substring(n,n+1)}function de(e){return e===N?F:N}function ti(e){const t=e.split(/\s+/);if(t.length!==6)return{ok:!1,error:"Invalid FEN: must contain six space-delimited fields"};const n=parseInt(t[5],10);if(isNaN(n)||n<=0)return{ok:!1,error:"Invalid FEN: move number must be a positive integer"};const o=parseInt(t[4],10);if(isNaN(o)||o<0)return{ok:!1,error:"Invalid FEN: half move counter number must be a non-negative integer"};if(!/^(-|[abcdefgh][36])$/.test(t[3]))return{ok:!1,error:"Invalid FEN: en-passant square is invalid"};if(/[^kKqQ-]/.test(t[2]))return{ok:!1,error:"Invalid FEN: castling availability is invalid"};if(!/^(w|b)$/.test(t[1]))return{ok:!1,error:"Invalid FEN: side-to-move is invalid"};const i=t[0].split("/");if(i.length!==8)return{ok:!1,error:"Invalid FEN: piece data does not contain 8 '/'-delimited rows"};for(let c=0;c<i.length;c++){let s=0,a=!1;for(let l=0;l<i[c].length;l++)if(Zt(i[c][l])){if(a)return{ok:!1,error:"Invalid FEN: piece data is invalid (consecutive number)"};s+=parseInt(i[c][l],10),a=!0}else{if(!/^[prnbqkPRNBQK]$/.test(i[c][l]))return{ok:!1,error:"Invalid FEN: piece data is invalid (invalid piece)"};s+=1,a=!1}if(s!==8)return{ok:!1,error:"Invalid FEN: piece data is invalid (too many squares in rank)"}}if(t[3][1]=="3"&&t[1]=="w"||t[3][1]=="6"&&t[1]=="b")return{ok:!1,error:"Invalid FEN: illegal en-passant square"};const r=[{color:"white",regex:/K/g},{color:"black",regex:/k/g}];for(const{color:c,regex:s}of r){if(!s.test(t[0]))return{ok:!1,error:`Invalid FEN: missing ${c} king`};if((t[0].match(s)||[]).length>1)return{ok:!1,error:`Invalid FEN: too many ${c} kings`}}return{ok:!0}}function ni(e,t){const n=e.from,o=e.to,i=e.piece;let r=0,c=0,s=0;for(let a=0,l=t.length;a<l;a++){const g=t[a].from,h=t[a].to,f=t[a].piece;i===f&&n!==g&&o===h&&(r++,se(n)===se(g)&&c++,_e(n)===_e(g)&&s++)}return r>0?c>0&&s>0?K(n):s>0?K(n).charAt(1):K(n).charAt(0):""}function X(e,t,n,o,i,r=void 0,c=v.NORMAL){const s=se(o);if(i===A&&(s===zo||s===Xo))for(let a=0;a<_t.length;a++){const l=_t[a];e.push({color:t,from:n,to:o,piece:i,captured:r,promotion:l,flags:c|v.PROMOTION})}else e.push({color:t,from:n,to:o,piece:i,captured:r,flags:c})}function vt(e){let t=e.charAt(0);return t>="a"&&t<="h"?e.match(/[a-h]\d.*[a-h]\d/)?void 0:A:(t=t.toLowerCase(),t==="o"?T:t)}function De(e){return e.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}let oi=class{constructor(t=qe){D(this,"_board",new Array(128));D(this,"_turn",N);D(this,"_header",{});D(this,"_kings",{w:R,b:R});D(this,"_epSquare",-1);D(this,"_halfMoves",0);D(this,"_moveNumber",0);D(this,"_history",[]);D(this,"_comments",{});D(this,"_castling",{w:0,b:0});this.load(t)}clear(t=!1){this._board=new Array(128),this._kings={w:R,b:R},this._turn=N,this._castling={w:0,b:0},this._epSquare=R,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=t?this._header:{},this._updateSetup(this.fen())}removeHeader(t){t in this._header&&delete this._header[t]}load(t,n=!1){let o=t.split(/\s+/);if(o.length>=2&&o.length<6){const a=["-","-","0","1"];t=o.concat(a.slice(-(6-o.length))).join(" ")}o=t.split(/\s+/);const{ok:i,error:r}=ti(t);if(!i)throw new Error(r);const c=o[0];let s=0;this.clear(n);for(let a=0;a<c.length;a++){const l=c.charAt(a);if(l==="/")s+=8;else if(Zt(l))s+=parseInt(l,10);else{const g=l<"a"?N:F;this.put({type:l.toLowerCase(),color:g},K(s)),s++}}this._turn=o[1],o[2].indexOf("K")>-1&&(this._castling.w|=v.KSIDE_CASTLE),o[2].indexOf("Q")>-1&&(this._castling.w|=v.QSIDE_CASTLE),o[2].indexOf("k")>-1&&(this._castling.b|=v.KSIDE_CASTLE),o[2].indexOf("q")>-1&&(this._castling.b|=v.QSIDE_CASTLE),this._epSquare=o[3]==="-"?R:S[o[3]],this._halfMoves=parseInt(o[4],10),this._moveNumber=parseInt(o[5],10),this._updateSetup(this.fen())}fen(){var r,c;let t=0,n="";for(let s=S.a8;s<=S.h1;s++){if(this._board[s]){t>0&&(n+=t,t=0);const{color:a,type:l}=this._board[s];n+=a===N?l.toUpperCase():l.toLowerCase()}else t++;s+1&136&&(t>0&&(n+=t),s!==S.h1&&(n+="/"),t=0,s+=8)}let o="";this._castling[N]&v.KSIDE_CASTLE&&(o+="K"),this._castling[N]&v.QSIDE_CASTLE&&(o+="Q"),this._castling[F]&v.KSIDE_CASTLE&&(o+="k"),this._castling[F]&v.QSIDE_CASTLE&&(o+="q"),o=o||"-";let i="-";if(this._epSquare!==R){const s=this._epSquare+(this._turn===N?16:-16),a=[s+1,s-1];for(const l of a){if(l&136)continue;const g=this._turn;if(((r=this._board[l])==null?void 0:r.color)===g&&((c=this._board[l])==null?void 0:c.type)===A){this._makeMove({color:g,from:l,to:this._epSquare,piece:A,captured:A,flags:v.EP_CAPTURE});const h=!this._isKingAttacked(g);if(this._undoMove(),h){i=K(this._epSquare);break}}}}return[n,this._turn,o,i,this._halfMoves,this._moveNumber].join(" ")}_updateSetup(t){this._history.length>0||(t!==qe?(this._header.SetUp="1",this._header.FEN=t):(delete this._header.SetUp,delete this._header.FEN))}reset(){this.load(qe)}get(t){return this._board[S[t]]||!1}put({type:t,color:n},o){if(Vo.indexOf(t.toLowerCase())===-1||!(o in S))return!1;const i=S[o];return t==T&&!(this._kings[n]==R||this._kings[n]==i)?!1:(this._board[i]={type:t,color:n},t===T&&(this._kings[n]=i),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),!0)}remove(t){const n=this.get(t);return delete this._board[S[t]],n&&n.type===T&&(this._kings[n.color]=R),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),n}_updateCastlingRights(){var o,i,r,c,s,a,l,g,h,f,k,u;const t=((o=this._board[S.e1])==null?void 0:o.type)===T&&((i=this._board[S.e1])==null?void 0:i.color)===N,n=((r=this._board[S.e8])==null?void 0:r.type)===T&&((c=this._board[S.e8])==null?void 0:c.color)===F;(!t||((s=this._board[S.a1])==null?void 0:s.type)!==he||((a=this._board[S.a1])==null?void 0:a.color)!==N)&&(this._castling.w&=~v.QSIDE_CASTLE),(!t||((l=this._board[S.h1])==null?void 0:l.type)!==he||((g=this._board[S.h1])==null?void 0:g.color)!==N)&&(this._castling.w&=~v.KSIDE_CASTLE),(!n||((h=this._board[S.a8])==null?void 0:h.type)!==he||((f=this._board[S.a8])==null?void 0:f.color)!==F)&&(this._castling.b&=~v.QSIDE_CASTLE),(!n||((k=this._board[S.h8])==null?void 0:k.type)!==he||((u=this._board[S.h8])==null?void 0:u.color)!==F)&&(this._castling.b&=~v.KSIDE_CASTLE)}_updateEnPassantSquare(){var r,c;if(this._epSquare===R)return;const t=this._epSquare+(this._turn===N?-16:16),n=this._epSquare+(this._turn===N?16:-16),o=[n+1,n-1];if(this._board[t]!==null||this._board[this._epSquare]!==null||((r=this._board[n])==null?void 0:r.color)!==de(this._turn)||((c=this._board[n])==null?void 0:c.type)!==A){this._epSquare=R;return}const i=s=>{var a,l;return!(s&136)&&((a=this._board[s])==null?void 0:a.color)===this._turn&&((l=this._board[s])==null?void 0:l.type)===A};o.some(i)||(this._epSquare=R)}_attacked(t,n){for(let o=S.a8;o<=S.h1;o++){if(o&136){o+=7;continue}if(this._board[o]===void 0||this._board[o].color!==t)continue;const i=this._board[o],r=o-n;if(r===0)continue;const c=r+119;if(Wo[c]&Go[i.type]){if(i.type===A){if(r>0){if(i.color===N)return!0}else if(i.color===F)return!0;continue}if(i.type==="n"||i.type==="k")return!0;const s=Jo[c];let a=o+s,l=!1;for(;a!==n;){if(this._board[a]!=null){l=!0;break}a+=s}if(!l)return!0}}return!1}_isKingAttacked(t){const n=this._kings[t];return n===-1?!1:this._attacked(de(t),n)}isAttacked(t,n){return this._attacked(n,S[t])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&this._moves().length===0}isStalemate(){return!this.isCheck()&&this._moves().length===0}isInsufficientMaterial(){const t={b:0,n:0,r:0,q:0,k:0,p:0},n=[];let o=0,i=0;for(let r=S.a8;r<=S.h1;r++){if(i=(i+1)%2,r&136){r+=7;continue}const c=this._board[r];c&&(t[c.type]=c.type in t?t[c.type]+1:1,c.type===Se&&n.push(i),o++)}if(o===2)return!0;if(o===3&&(t[Se]===1||t[Be]===1))return!0;if(o===t[Se]+2){let r=0;const c=n.length;for(let s=0;s<c;s++)r+=n[s];if(r===0||r===c)return!0}return!1}isThreefoldRepetition(){const t=[],n={};let o=!1;for(;;){const i=this._undoMove();if(!i)break;t.push(i)}for(;;){const i=this.fen().split(" ").slice(0,4).join(" ");n[i]=i in n?n[i]+1:1,n[i]>=3&&(o=!0);const r=t.pop();if(r)this._makeMove(r);else break}return o}isDraw(){return this._halfMoves>=100||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isStalemate()||this.isDraw()}moves({verbose:t=!1,square:n=void 0,piece:o=void 0}={}){const i=this._moves({square:n,piece:o});return t?i.map(r=>this._makePretty(r)):i.map(r=>this._moveToSan(r,i))}_moves({legal:t=!0,piece:n=void 0,square:o=void 0}={}){var k;const i=o?o.toLowerCase():void 0,r=n==null?void 0:n.toLowerCase(),c=[],s=this._turn,a=de(s);let l=S.a8,g=S.h1,h=!1;if(i)if(i in S)l=g=S[i],h=!0;else return[];for(let u=l;u<=g;u++){if(u&136){u+=7;continue}if(!this._board[u]||this._board[u].color===a)continue;const{type:d}=this._board[u];let w;if(d===A){if(r&&r!==d)continue;w=u+xe[s][0],this._board[w]||(X(c,s,u,w,A),w=u+xe[s][1],$o[s]===se(u)&&!this._board[w]&&X(c,s,u,w,A,void 0,v.BIG_PAWN));for(let m=2;m<4;m++)w=u+xe[s][m],!(w&136)&&(((k=this._board[w])==null?void 0:k.color)===a?X(c,s,u,w,A,this._board[w].type,v.CAPTURE):w===this._epSquare&&X(c,s,u,w,A,A,v.EP_CAPTURE))}else{if(r&&r!==d)continue;for(let m=0,P=bt[d].length;m<P;m++){const p=bt[d][m];for(w=u;w+=p,!(w&136);){if(!this._board[w])X(c,s,u,w,d);else{if(this._board[w].color===s)break;X(c,s,u,w,d,this._board[w].type,v.CAPTURE);break}if(d===Be||d===T)break}}}}if((r===void 0||r===T)&&(!h||g===this._kings[s])){if(this._castling[s]&v.KSIDE_CASTLE){const u=this._kings[s],d=u+2;!this._board[u+1]&&!this._board[d]&&!this._attacked(a,this._kings[s])&&!this._attacked(a,u+1)&&!this._attacked(a,d)&&X(c,s,this._kings[s],d,T,void 0,v.KSIDE_CASTLE)}if(this._castling[s]&v.QSIDE_CASTLE){const u=this._kings[s],d=u-2;!this._board[u-1]&&!this._board[u-2]&&!this._board[u-3]&&!this._attacked(a,this._kings[s])&&!this._attacked(a,u-1)&&!this._attacked(a,d)&&X(c,s,this._kings[s],d,T,void 0,v.QSIDE_CASTLE)}}if(!t||this._kings[s]===-1)return c;const f=[];for(let u=0,d=c.length;u<d;u++)this._makeMove(c[u]),this._isKingAttacked(s)||f.push(c[u]),this._undoMove();return f}move(t,{strict:n=!1}={}){let o=null;if(typeof t=="string")o=this._moveFromSan(t,n);else if(typeof t=="object"){const r=this._moves();for(let c=0,s=r.length;c<s;c++)if(t.from===K(r[c].from)&&t.to===K(r[c].to)&&(!("promotion"in r[c])||t.promotion===r[c].promotion)){o=r[c];break}}if(!o)throw typeof t=="string"?new Error(`Invalid move: ${t}`):new Error(`Invalid move: ${JSON.stringify(t)}`);const i=this._makePretty(o);return this._makeMove(o),i}_push(t){this._history.push({move:t,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_makeMove(t){const n=this._turn,o=de(n);if(this._push(t),this._board[t.to]=this._board[t.from],delete this._board[t.from],t.flags&v.EP_CAPTURE&&(this._turn===F?delete this._board[t.to-16]:delete this._board[t.to+16]),t.promotion&&(this._board[t.to]={type:t.promotion,color:n}),this._board[t.to].type===T){if(this._kings[n]=t.to,t.flags&v.KSIDE_CASTLE){const i=t.to-1,r=t.to+1;this._board[i]=this._board[r],delete this._board[r]}else if(t.flags&v.QSIDE_CASTLE){const i=t.to+1,r=t.to-2;this._board[i]=this._board[r],delete this._board[r]}this._castling[n]=0}if(this._castling[n]){for(let i=0,r=Y[n].length;i<r;i++)if(t.from===Y[n][i].square&&this._castling[n]&Y[n][i].flag){this._castling[n]^=Y[n][i].flag;break}}if(this._castling[o]){for(let i=0,r=Y[o].length;i<r;i++)if(t.to===Y[o][i].square&&this._castling[o]&Y[o][i].flag){this._castling[o]^=Y[o][i].flag;break}}t.flags&v.BIG_PAWN?n===F?this._epSquare=t.to-16:this._epSquare=t.to+16:this._epSquare=R,t.piece===A?this._halfMoves=0:t.flags&(v.CAPTURE|v.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,n===F&&this._moveNumber++,this._turn=o}undo(){const t=this._undoMove();return t?this._makePretty(t):null}_undoMove(){const t=this._history.pop();if(t===void 0)return null;const n=t.move;this._kings=t.kings,this._turn=t.turn,this._castling=t.castling,this._epSquare=t.epSquare,this._halfMoves=t.halfMoves,this._moveNumber=t.moveNumber;const o=this._turn,i=de(o);if(this._board[n.from]=this._board[n.to],this._board[n.from].type=n.piece,delete this._board[n.to],n.captured)if(n.flags&v.EP_CAPTURE){let r;o===F?r=n.to-16:r=n.to+16,this._board[r]={type:A,color:i}}else this._board[n.to]={type:n.captured,color:i};if(n.flags&(v.KSIDE_CASTLE|v.QSIDE_CASTLE)){let r,c;n.flags&v.KSIDE_CASTLE?(r=n.to+1,c=n.to-1):(r=n.to-2,c=n.to+1),this._board[r]=this._board[c],delete this._board[c]}return n}pgn({newline:t=`
`,maxWidth:n=0}={}){const o=[];let i=!1;for(const f in this._header)o.push("["+f+' "'+this._header[f]+'"]'+t),i=!0;i&&this._history.length&&o.push(t);const r=f=>{const k=this._comments[this.fen()];if(typeof k<"u"){const u=f.length>0?" ":"";f=`${f}${u}{${k}}`}return f},c=[];for(;this._history.length>0;)c.push(this._undoMove());const s=[];let a="";for(c.length===0&&s.push(r(""));c.length>0;){a=r(a);const f=c.pop();if(!f)break;if(!this._history.length&&f.color==="b"){const k=`${this._moveNumber}. ...`;a=a?`${a} ${k}`:k}else f.color==="w"&&(a.length&&s.push(a),a=this._moveNumber+".");a=a+" "+this._moveToSan(f,this._moves({legal:!0})),this._makeMove(f)}if(a.length&&s.push(r(a)),typeof this._header.Result<"u"&&s.push(this._header.Result),n===0)return o.join("")+s.join(" ");const l=function(){return o.length>0&&o[o.length-1]===" "?(o.pop(),!0):!1},g=function(f,k){for(const u of k.split(" "))if(u){if(f+u.length>n){for(;l();)f--;o.push(t),f=0}o.push(u),f+=u.length,o.push(" "),f++}return l()&&f--,f};let h=0;for(let f=0;f<s.length;f++){if(h+s[f].length>n&&s[f].includes("{")){h=g(h,s[f]);continue}h+s[f].length>n&&f!==0?(o[o.length-1]===" "&&o.pop(),o.push(t),h=0):f!==0&&(o.push(" "),h++),o.push(s[f]),h+=s[f].length}return o.join("")}header(...t){for(let n=0;n<t.length;n+=2)typeof t[n]=="string"&&typeof t[n+1]=="string"&&(this._header[t[n]]=t[n+1]);return this._header}loadPgn(t,{strict:n=!1,newlineChar:o=`\r?
`}={}){function i(p){return p.replace(/\\/g,"\\")}function r(p){const C={},E=p.split(new RegExp(i(o)));let H="",U="";for(let y=0;y<E.length;y++){const L=/^\s*\[\s*([A-Za-z]+)\s*"(.*)"\s*\]\s*$/;H=E[y].replace(L,"$1"),U=E[y].replace(L,"$2"),H.trim().length>0&&(C[H]=U)}return C}t=t.trim();const s=new RegExp("^(\\[((?:"+i(o)+")|.)*\\])((?:\\s*"+i(o)+"){2}|(?:\\s*"+i(o)+")*$)").exec(t),a=s&&s.length>=2?s[1]:"";this.reset();const l=r(a);let g="";for(const p in l)p.toLowerCase()==="fen"&&(g=l[p]),this.header(p,l[p]);if(!n)g&&this.load(g,!0);else if(l.SetUp==="1"){if(!("FEN"in l))throw new Error("Invalid PGN: FEN tag must be supplied with SetUp tag");this.load(l.FEN,!0)}function h(p){return Array.from(p).map(function(C){return C.charCodeAt(0)<128?C.charCodeAt(0).toString(16):encodeURIComponent(C).replace(/%/g,"").toLowerCase()}).join("")}function f(p){return p.length==0?"":decodeURIComponent("%"+(p.match(/.{1,2}/g)||[]).join("%"))}const k=function(p){return p=p.replace(new RegExp(i(o),"g")," "),`{${h(p.slice(1,p.length-1))}}`},u=function(p){if(p.startsWith("{")&&p.endsWith("}"))return f(p.slice(1,p.length-1))};let d=t.replace(a,"").replace(new RegExp(`({[^}]*})+?|;([^${i(o)}]*)`,"g"),function(p,C,E){return C!==void 0?k(C):" "+k(`{${E.slice(1)}}`)}).replace(new RegExp(i(o),"g")," ");const w=/(\([^()]+\))+?/g;for(;w.test(d);)d=d.replace(w,"");d=d.replace(/\d+\.(\.\.)?/g,""),d=d.replace(/\.\.\./g,""),d=d.replace(/\$\d+/g,"");let m=d.trim().split(new RegExp(/\s+/));m=m.filter(p=>p!=="");let P="";for(let p=0;p<m.length;p++){const C=u(m[p]);if(C!==void 0){this._comments[this.fen()]=C;continue}const E=this._moveFromSan(m[p],n);if(E==null)if(ei.indexOf(m[p])>-1)P=m[p];else throw new Error(`Invalid move in PGN: ${m[p]}`);else P="",this._makeMove(E)}P&&Object.keys(this._header).length&&!this._header.Result&&this.header("Result",P)}_moveToSan(t,n){let o="";if(t.flags&v.KSIDE_CASTLE)o="O-O";else if(t.flags&v.QSIDE_CASTLE)o="O-O-O";else{if(t.piece!==A){const i=ni(t,n);o+=t.piece.toUpperCase()+i}t.flags&(v.CAPTURE|v.EP_CAPTURE)&&(t.piece===A&&(o+=K(t.from)[0]),o+="x"),o+=K(t.to),t.promotion&&(o+="="+t.promotion.toUpperCase())}return this._makeMove(t),this.isCheck()&&(this.isCheckmate()?o+="#":o+="+"),this._undoMove(),o}_moveFromSan(t,n=!1){const o=De(t);let i=vt(o),r=this._moves({legal:!0,piece:i});for(let f=0,k=r.length;f<k;f++)if(o===De(this._moveToSan(r[f],r)))return r[f];if(n)return null;let c,s,a,l,g,h=!1;if(s=o.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/),s?(c=s[1],a=s[2],l=s[3],g=s[4],a.length==1&&(h=!0)):(s=o.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/),s&&(c=s[1],a=s[2],l=s[3],g=s[4],a.length==1&&(h=!0))),i=vt(o),r=this._moves({legal:!0,piece:c||i}),!l)return null;for(let f=0,k=r.length;f<k;f++)if(a){if((!c||c.toLowerCase()==r[f].piece)&&S[a]==r[f].from&&S[l]==r[f].to&&(!g||g.toLowerCase()==r[f].promotion))return r[f];if(h){const u=K(r[f].from);if((!c||c.toLowerCase()==r[f].piece)&&S[l]==r[f].to&&(a==u[0]||a==u[1])&&(!g||g.toLowerCase()==r[f].promotion))return r[f]}}else if(o===De(this._moveToSan(r[f],r)).replace("x",""))return r[f];return null}ascii(){let t=`   +------------------------+
`;for(let n=S.a8;n<=S.h1;n++){if(_e(n)===0&&(t+=" "+"87654321"[se(n)]+" |"),this._board[n]){const o=this._board[n].type,r=this._board[n].color===N?o.toUpperCase():o.toLowerCase();t+=" "+r+" "}else t+=" . ";n+1&136&&(t+=`|
`,n+=8)}return t+=`   +------------------------+
`,t+="     a  b  c  d  e  f  g  h",t}perft(t){const n=this._moves({legal:!1});let o=0;const i=this._turn;for(let r=0,c=n.length;r<c;r++)this._makeMove(n[r]),this._isKingAttacked(i)||(t-1>0?o+=this.perft(t-1):o++),this._undoMove();return o}_makePretty(t){const{color:n,piece:o,from:i,to:r,flags:c,captured:s,promotion:a}=t;let l="";for(const k in v)v[k]&c&&(l+=Ho[k]);const g=K(i),h=K(r),f={color:n,piece:o,from:g,to:h,san:this._moveToSan(t,this._moves({legal:!0})),flags:l,lan:g+h,before:this.fen(),after:""};return this._makeMove(t),f.after=this.fen(),this._undoMove(),s&&(f.captured=s),a&&(f.promotion=a,f.lan+=a),f}turn(){return this._turn}board(){const t=[];let n=[];for(let o=S.a8;o<=S.h1;o++)this._board[o]==null?n.push(null):n.push({square:K(o),type:this._board[o].type,color:this._board[o].color}),o+1&136&&(t.push(n),n=[],o+=8);return t}squareColor(t){if(t in S){const n=S[t];return(se(n)+_e(n))%2===0?"light":"dark"}return null}history({verbose:t=!1}={}){const n=[],o=[];for(;this._history.length>0;)n.push(this._undoMove());for(;;){const i=n.pop();if(!i)break;t?o.push(this._makePretty(i)):o.push(this._moveToSan(i,this._moves())),this._makeMove(i)}return o}_pruneComments(){const t=[],n={},o=i=>{i in this._comments&&(n[i]=this._comments[i])};for(;this._history.length>0;)t.push(this._undoMove());for(o(this.fen());;){const i=t.pop();if(!i)break;this._makeMove(i),o(this.fen())}this._comments=n}getComment(){return this._comments[this.fen()]}setComment(t){this._comments[this.fen()]=t.replace("{","[").replace("}","]")}deleteComment(){const t=this._comments[this.fen()];return delete this._comments[this.fen()],t}getComments(){return this._pruneComments(),Object.keys(this._comments).map(t=>({fen:t,comment:this._comments[t]}))}deleteComments(){return this._pruneComments(),Object.keys(this._comments).map(t=>{const n=this._comments[t];return delete this._comments[t],{fen:t,comment:n}})}setCastlingRights(t,n){for(const i of[T,ee])n[i]!==void 0&&(n[i]?this._castling[t]|=we[i]:this._castling[t]&=~we[i]);this._updateCastlingRights();const o=this.getCastlingRights(t);return(n[T]===void 0||n[T]===o[T])&&(n[ee]===void 0||n[ee]===o[ee])}getCastlingRights(t){return{[T]:(this._castling[t]&we[T])!==0,[ee]:(this._castling[t]&we[ee])!==0}}moveNumber(){return this._moveNumber}};class W{constructor(t,n="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",o=a=>{},i=async a=>"q",r=a=>{},c=a=>{},s="w"){D(this,"chessJS");D(this,"gameIsOver",!1);this.cg=t,this.stateChangeCallback=o,this.promotionCallback=i,this.moveCallback=r,this.gameOverCallback=c,this._orientation=s,this.cg.set({orientation:W._colorToCgColor(s),movable:{free:!1}}),this.chessJS=new oi(n),this.load(n)}load(t){this.chessJS.load(t),this._checkForGameOver(),this.cg.set({animation:{enabled:!1}});const n=W._colorToCgColor(this.chessJS.turn());this.cg.set({fen:t,turnColor:n,check:this.chessJS.inCheck(),lastMove:void 0,selected:void 0,movable:{free:!1,color:n,dests:this.possibleMovesDests(),events:{after:(o,i)=>{this._chessgroundMoveCallback(o,i)}}}}),this.cg.set({animation:{enabled:!0}}),this.stateChangeCallback(this)}async _chessgroundMoveCallback(t,n){if(t==="a0"||n==="a0")throw Error("invalid square");let o;if(this._moveIsPromotion(t,n)){const r=await this.promotionCallback(n);o=this.chessJS.move({from:t,to:n,promotion:r})}else o=this.chessJS.move({from:t,to:n});const i=W._cjsMoveToMove(o);this._updateChessgroundAfterMove(i)}_moveIsPromotion(t,n){return this.chessJS.get(t).type==="p"&&(n.charAt(1)=="1"||n.charAt(1)=="8")}move(t){if(this.gameIsOver)throw new Error("Invalid move: Game is over.");const n=this.chessJS.move(t),o=W._cjsMoveToMove(n);this.cg.move(o.from,o.to),this._updateChessgroundAfterMove(o)}_updateChessgroundAfterMove(t){(t.flags.includes("e")||t.flags.includes("p"))&&this.cg.set({fen:this.chessJS.fen()}),t.check&&this.cg.set({check:!0}),this.moveCallback(t),this._checkForGameOver(),this._updateChessgroundWithPossibleMoves(),this.stateChangeCallback(this)}_updateChessgroundWithPossibleMoves(){const t=W._colorToCgColor(this.chessJS.turn());this.cg.set({turnColor:t,movable:{color:t,dests:this.possibleMovesDests()}})}_checkForGameOver(){if(this.chessJS.isCheckmate()){const t=this.chessJS.turn()=="w"?0:1;this.gameOverCallback({reason:"checkmate",result:t}),this.gameIsOver=!0}else this.chessJS.isStalemate()?(this.gameOverCallback({reason:"stalemate",result:.5}),this.gameIsOver=!0):this.chessJS.isInsufficientMaterial()?(this.gameOverCallback({reason:"insufficient material",result:.5}),this.gameIsOver=!0):this.chessJS.isThreefoldRepetition()?(this.gameOverCallback({reason:"repetition",result:.5}),this.gameIsOver=!0):this.chessJS.isDraw()?(this.gameOverCallback({reason:"fifty-move rule",result:.5}),this.gameIsOver=!0):this.gameIsOver=!1}possibleMovesDests(){const t=new Map;return this.gameIsOver||Uo.forEach(n=>{const o=this.chessJS.moves({square:n,verbose:!0});o.length&&t.set(n,o.map(i=>i.to))}),t}reset(){this.load("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1")}undo(){const t=this.chessJS.undo(),n=t?W._cjsMoveToMove(t):null;return this.cg.set({fen:this.chessJS.fen(),turnColor:W._colorToCgColor(this.chessJS.turn()),lastMove:void 0}),this.gameIsOver=!1,this._updateChessgroundWithPossibleMoves(),this.stateChangeCallback(this),n}toggleOrientation(){this._orientation=this._orientation==="w"?"b":"w",this.cg.set({orientation:W._colorToCgColor(this._orientation)}),this.stateChangeCallback(this)}orientation(){return this._orientation}isGameOver(){return this.gameIsOver}fen(){return this.chessJS.fen()}turn(){return this.chessJS.turn()}moveNumber(){return this.chessJS.moveNumber()}inCheck(){return this.chessJS.inCheck()}history({verbose:t=!1}={}){return t?this.chessJS.history({verbose:t}).map(W._cjsMoveToMove):this.chessJS.history({verbose:t})}board(){return this.chessJS.board()}static _colorToCgColor(t){return t==="w"?"white":"black"}static _cgColorToColor(t){return t==="white"?"w":"b"}static _cjsMoveToMove(t){const n=t.san.slice(-1),o=n==="#";return{...t,check:n==="+"||o,checkmate:o}}}function ii(e){let t,n,o,i={className:e[0]};return n=new Fo({props:i}),e[17](n),{c(){t=ge("div"),pn(n.$$.fragment),this.h()},l(r){t=pe(r,"DIV",{style:!0});var c=me(t);mn(n.$$.fragment,c),c.forEach(z),this.h()},h(){ke(t,"position","relative")},m(r,c){Ee(r,t,c),bn(n,t,null),e[18](t),o=!0},p(r,[c]){const s={};c&1&&(s.className=r[0]),n.$set(s)},i(r){o||(_n(n.$$.fragment,r),o=!0)},o(r){vn(n.$$.fragment,r),o=!1},d(r){r&&z(t),e[17](null),wn(n),e[18](null)}}}function ri(e,t,n){const o=kn();let i,r,{moveNumber:c=0}=t,{turn:s="w"}=t,{inCheck:a=!1}=t,{history:l=[]}=t,{isGameOver:g=!1}=t,{fen:h="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1"}=t,{orientation:f="w"}=t,{class:k=void 0}=t,u;function d(_){if(!u)throw new Error("component not mounted yet");u.load(_)}function w(_){if(!u)throw new Error("component not mounted yet");u.move(_)}function m({verbose:_=!1}={}){if(!u)throw new Error("component not mounted yet");return u.history({verbose:_})}function P(){if(!u)throw new Error("component not mounted yet");return u.board()}function p(){if(!u)throw new Error("component not mounted yet");return u.undo()}function C(){if(!u)throw new Error("component not mounted yet");u.reset()}function E(){if(!u)throw new Error("component not mounted yet");u.toggleOrientation()}function H(_){n(8,h=_.fen()),n(9,f=_.orientation()),n(3,c=_.moveNumber()),n(4,s=_.turn()),n(5,a=_.inCheck()),n(6,l=_.history()),n(7,g=_.isGameOver())}function U(_){return new Promise(Me=>{const Ae=new Qo({target:r,props:{square:_,orientation:f,callback:Te=>{Ae.$destroy(),Me(Te)}}})})}function y(_){o("move",_)}function L(_){o("gameOver",_)}wt(()=>{u=new W(i,h,H,U,y,L,f)});function O(_){Re[_?"unshift":"push"](()=>{i=_,n(1,i)})}function I(_){Re[_?"unshift":"push"](()=>{r=_,n(2,r)})}return e.$$set=_=>{"moveNumber"in _&&n(3,c=_.moveNumber),"turn"in _&&n(4,s=_.turn),"inCheck"in _&&n(5,a=_.inCheck),"history"in _&&n(6,l=_.history),"isGameOver"in _&&n(7,g=_.isGameOver),"fen"in _&&n(8,h=_.fen),"orientation"in _&&n(9,f=_.orientation),"class"in _&&n(0,k=_.class)},[k,i,r,c,s,a,l,g,h,f,d,w,m,P,p,C,E,O,I]}class li extends je{constructor(t){super(),Qe(this,t,ri,ii,He,{moveNumber:3,turn:4,inCheck:5,history:6,isGameOver:7,fen:8,orientation:9,class:0,load:10,move:11,getHistory:12,getBoard:13,undo:14,reset:15,toggleOrientation:16})}get load(){return this.$$.ctx[10]}get move(){return this.$$.ctx[11]}get getHistory(){return this.$$.ctx[12]}get getBoard(){return this.$$.ctx[13]}get undo(){return this.$$.ctx[14]}get reset(){return this.$$.ctx[15]}get toggleOrientation(){return this.$$.ctx[16]}}export{li as C};
