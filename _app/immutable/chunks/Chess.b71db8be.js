var ln=Object.defineProperty;var un=(t,e,n)=>e in t?ln(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var x=(t,e,n)=>(un(t,typeof e!="symbol"?e+"":e,n),n);import{S as Ue,i as He,s as Je,k as pe,l as me,m as be,h as z,n as G,b as Me,H as Ce,o as yt,w as Le,U as fn,a as hn,c as dn,X as it,p as ye,G as ot,J as rt,K as gn,y as pn,z as mn,A as bn,g as vn,d as _n,B as wn,Y as kn}from"./index.18b0dfda.js";const yn=["white","black"],We=["a","b","c","d","e","f","g","h"],Ge=["1","2","3","4","5","6","7","8"],Sn=[...Ge].reverse(),Ve=Array.prototype.concat(...We.map(t=>Ge.map(e=>t+e))),j=t=>Ve[8*t[0]+t[1]],M=t=>[t.charCodeAt(0)-97,t.charCodeAt(1)-49],St=Ve.map(M);function Cn(t){let e;const n=()=>(e===void 0&&(e=t()),e);return n.clear=()=>{e=void 0},n}const Pn=()=>{let t;return{start(){t=performance.now()},cancel(){t=void 0},stop(){if(!t)return 0;const e=performance.now()-t;return t=void 0,e}}},ze=t=>t==="white"?"black":"white",ve=(t,e)=>{const n=t[0]-e[0],i=t[1]-e[1];return n*n+i*i},Fe=(t,e)=>t.role===e.role&&t.color===e.color,we=t=>(e,n)=>[(n?e[0]:7-e[0])*t.width/8,(n?7-e[1]:e[1])*t.height/8],W=(t,e)=>{t.style.transform=`translate(${e[0]}px,${e[1]}px)`},Ct=(t,e,n=1)=>{t.style.transform=`translate(${e[0]}px,${e[1]}px) scale(${n})`},Ze=(t,e)=>{t.style.visibility=e?"visible":"hidden"},le=t=>{var e;if(t.clientX||t.clientX===0)return[t.clientX,t.clientY];if(!((e=t.targetTouches)===null||e===void 0)&&e[0])return[t.targetTouches[0].clientX,t.targetTouches[0].clientY]},Pt=t=>t.buttons===2||t.button===2,V=(t,e)=>{const n=document.createElement(t);return e&&(n.className=e),n};function Et(t,e,n){const i=M(t);return e||(i[0]=7-i[0],i[1]=7-i[1]),[n.left+n.width*i[0]/8+n.width/16,n.top+n.height*(7-i[1])/8+n.height/16]}const ae=(t,e)=>Math.abs(t-e),En=t=>(e,n,i,o)=>ae(e,i)<2&&(t==="white"?o===n+1||n<=1&&o===n+2&&e===i:o===n-1||n>=6&&o===n-2&&e===i),Mt=(t,e,n,i)=>{const o=ae(t,n),r=ae(e,i);return o===1&&r===2||o===2&&r===1},At=(t,e,n,i)=>ae(t,n)===ae(e,i),Tt=(t,e,n,i)=>t===n||e===i,Nt=(t,e,n,i)=>At(t,e,n,i)||Tt(t,e,n,i),Mn=(t,e,n)=>(i,o,r,c)=>ae(i,r)<2&&ae(o,c)<2||n&&o===c&&o===(t==="white"?0:7)&&(i===4&&(r===2&&e.includes(0)||r===6&&e.includes(7))||e.includes(r));function An(t,e){const n=e==="white"?"1":"8",i=[];for(const[o,r]of t)o[1]===n&&r.color===e&&r.role==="rook"&&i.push(M(o)[0]);return i}function Ot(t,e,n){const i=t.get(e);if(!i)return[];const o=M(e),r=i.role,c=r==="pawn"?En(i.color):r==="knight"?Mt:r==="bishop"?At:r==="rook"?Tt:r==="queen"?Nt:Mn(i.color,An(t,i.color),n);return St.filter(s=>(o[0]!==s[0]||o[1]!==s[1])&&c(o[0],o[1],s[0],s[1])).map(j)}function q(t,...e){t&&setTimeout(()=>t(...e),1)}function Tn(t){t.orientation=ze(t.orientation),t.animation.current=t.draggable.current=t.selected=void 0}function Nn(t,e){for(const[n,i]of e)i?t.pieces.set(n,i):t.pieces.delete(n)}function On(t,e){if(t.check=void 0,e===!0&&(e=t.turnColor),e)for(const[n,i]of t.pieces)i.role==="king"&&i.color===e&&(t.check=n)}function In(t,e,n,i){oe(t),t.premovable.current=[e,n],q(t.premovable.events.set,e,n,i)}function ie(t){t.premovable.current&&(t.premovable.current=void 0,q(t.premovable.events.unset))}function xn(t,e,n){ie(t),t.predroppable.current={role:e,key:n},q(t.predroppable.events.set,e,n)}function oe(t){const e=t.predroppable;e.current&&(e.current=void 0,q(e.events.unset))}function qn(t,e,n){if(!t.autoCastle)return!1;const i=t.pieces.get(e);if(!i||i.role!=="king")return!1;const o=M(e),r=M(n);if(o[1]!==0&&o[1]!==7||o[1]!==r[1])return!1;o[0]===4&&!t.pieces.has(n)&&(r[0]===6?n=j([7,r[1]]):r[0]===2&&(n=j([0,r[1]])));const c=t.pieces.get(n);return!c||c.color!==i.color||c.role!=="rook"?!1:(t.pieces.delete(e),t.pieces.delete(n),o[0]<r[0]?(t.pieces.set(j([6,r[1]]),i),t.pieces.set(j([5,r[1]]),c)):(t.pieces.set(j([2,r[1]]),i),t.pieces.set(j([3,r[1]]),c)),!0)}function It(t,e,n){const i=t.pieces.get(e),o=t.pieces.get(n);if(e===n||!i)return!1;const r=o&&o.color!==i.color?o:void 0;return n===t.selected&&U(t),q(t.events.move,e,n,r),qn(t,e,n)||(t.pieces.set(n,i),t.pieces.delete(e)),t.lastMove=[e,n],t.check=void 0,q(t.events.change),r||!0}function Ye(t,e,n,i){if(t.pieces.has(n))if(i)t.pieces.delete(n);else return!1;return q(t.events.dropNewPiece,e,n),t.pieces.set(n,e),t.lastMove=[n],t.check=void 0,q(t.events.change),t.movable.dests=void 0,t.turnColor=ze(t.turnColor),!0}function xt(t,e,n){const i=It(t,e,n);return i&&(t.movable.dests=void 0,t.turnColor=ze(t.turnColor),t.animation.current=void 0),i}function qt(t,e,n){if(Xe(t,e,n)){const i=xt(t,e,n);if(i){const o=t.hold.stop();U(t);const r={premove:!1,ctrlKey:t.stats.ctrlKey,holdTime:o};return i!==!0&&(r.captured=i),q(t.movable.events.after,e,n,r),!0}}else if(Rn(t,e,n))return In(t,e,n,{ctrlKey:t.stats.ctrlKey}),U(t),!0;return U(t),!1}function Dt(t,e,n,i){const o=t.pieces.get(e);o&&(Dn(t,e,n)||i)?(t.pieces.delete(e),Ye(t,o,n,i),q(t.movable.events.afterNewPiece,o.role,n,{premove:!1,predrop:!1})):o&&Kn(t,e,n)?xn(t,o.role,n):(ie(t),oe(t)),t.pieces.delete(e),U(t)}function Be(t,e,n){if(q(t.events.select,e),t.selected){if(t.selected===e&&!t.draggable.enabled){U(t),t.hold.cancel();return}else if((t.selectable.enabled||n)&&t.selected!==e&&qt(t,t.selected,e)){t.stats.dragged=!1;return}}(t.selectable.enabled||t.draggable.enabled)&&(Kt(t,e)||$e(t,e))&&(Rt(t,e),t.hold.start())}function Rt(t,e){t.selected=e,$e(t,e)?t.premovable.dests=Ot(t.pieces,e,t.premovable.castle):t.premovable.dests=void 0}function U(t){t.selected=void 0,t.premovable.dests=void 0,t.hold.cancel()}function Kt(t,e){const n=t.pieces.get(e);return!!n&&(t.movable.color==="both"||t.movable.color===n.color&&t.turnColor===n.color)}const Xe=(t,e,n)=>{var i,o;return e!==n&&Kt(t,e)&&(t.movable.free||!!(!((o=(i=t.movable.dests)===null||i===void 0?void 0:i.get(e))===null||o===void 0)&&o.includes(n)))};function Dn(t,e,n){const i=t.pieces.get(e);return!!i&&(e===n||!t.pieces.has(n))&&(t.movable.color==="both"||t.movable.color===i.color&&t.turnColor===i.color)}function $e(t,e){const n=t.pieces.get(e);return!!n&&t.premovable.enabled&&t.movable.color===n.color&&t.turnColor!==n.color}const Rn=(t,e,n)=>e!==n&&$e(t,e)&&Ot(t.pieces,e,t.premovable.castle).includes(n);function Kn(t,e,n){const i=t.pieces.get(e),o=t.pieces.get(n);return!!i&&(!o||o.color!==t.movable.color)&&t.predroppable.enabled&&(i.role!=="pawn"||n[1]!=="1"&&n[1]!=="8")&&t.movable.color===i.color&&t.turnColor!==i.color}function Ln(t,e){const n=t.pieces.get(e);return!!n&&t.draggable.enabled&&(t.movable.color==="both"||t.movable.color===n.color&&(t.turnColor===n.color||t.premovable.enabled))}function Fn(t){const e=t.premovable.current;if(!e)return!1;const n=e[0],i=e[1];let o=!1;if(Xe(t,n,i)){const r=xt(t,n,i);if(r){const c={premove:!0};r!==!0&&(c.captured=r),q(t.movable.events.after,n,i,c),o=!0}}return ie(t),o}function Bn(t,e){const n=t.predroppable.current;let i=!1;if(!n)return!1;if(e(n)){const o={role:n.role,color:t.movable.color};Ye(t,o,n.key)&&(q(t.movable.events.afterNewPiece,n.role,n.key,{premove:!1,predrop:!0}),i=!0)}return oe(t),i}function et(t){ie(t),oe(t),U(t)}function st(t){t.movable.color=t.movable.dests=t.animation.current=void 0,et(t)}function ue(t,e,n){let i=Math.floor(8*(t[0]-n.left)/n.width);e||(i=7-i);let o=7-Math.floor(8*(t[1]-n.top)/n.height);return e||(o=7-o),i>=0&&i<8&&o>=0&&o<8?j([i,o]):void 0}function jn(t,e,n,i){const o=M(t),r=St.filter(a=>Nt(o[0],o[1],a[0],a[1])||Mt(o[0],o[1],a[0],a[1])),s=r.map(a=>Et(j(a),n,i)).map(a=>ve(e,a)),[,l]=s.reduce((a,g,d)=>a[0]<g?a:[g,d],[s[0],0]);return j(r[l])}const D=t=>t.orientation==="white",Lt="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",Qn={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},Un={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};function Ft(t){t==="start"&&(t=Lt);const e=new Map;let n=7,i=0;for(const o of t)switch(o){case" ":case"[":return e;case"/":if(--n,n<0)return e;i=0;break;case"~":{const r=e.get(j([i-1,n]));r&&(r.promoted=!0);break}default:{const r=o.charCodeAt(0);if(r<57)i+=r-48;else{const c=o.toLowerCase();e.set(j([i,n]),{role:Qn[c],color:o===c?"black":"white"}),++i}}}return e}function Hn(t){return Sn.map(e=>We.map(n=>{const i=t.get(n+e);if(i){let o=Un[i.role];return i.color==="white"&&(o=o.toUpperCase()),i.promoted&&(o+="~"),o}else return"1"}).join("")).join("/").replace(/1{2,}/g,e=>e.length.toString())}function Bt(t,e){e.animation&&(tt(t.animation,e.animation),(t.animation.duration||0)<70&&(t.animation.enabled=!1))}function jt(t,e){var n,i,o;if(!((n=e.movable)===null||n===void 0)&&n.dests&&(t.movable.dests=void 0),!((i=e.drawable)===null||i===void 0)&&i.autoShapes&&(t.drawable.autoShapes=[]),tt(t,e),e.fen&&(t.pieces=Ft(e.fen),t.drawable.shapes=((o=e.drawable)===null||o===void 0?void 0:o.shapes)||[]),"check"in e&&On(t,e.check||!1),"lastMove"in e&&!e.lastMove?t.lastMove=void 0:e.lastMove&&(t.lastMove=e.lastMove),t.selected&&Rt(t,t.selected),Bt(t,e),!t.movable.rookCastle&&t.movable.dests){const r=t.movable.color==="white"?"1":"8",c="e"+r,s=t.movable.dests.get(c),l=t.pieces.get(c);if(!s||!l||l.role!=="king")return;t.movable.dests.set(c,s.filter(a=>!(a==="a"+r&&s.includes("c"+r))&&!(a==="h"+r&&s.includes("g"+r))))}}function tt(t,e){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(Object.prototype.hasOwnProperty.call(t,n)&&ct(t[n])&&ct(e[n])?tt(t[n],e[n]):t[n]=e[n])}function ct(t){if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return e===Object.prototype||e===null}const se=(t,e)=>e.animation.enabled?Gn(t,e):ee(t,e);function ee(t,e){const n=t(e);return e.dom.redraw(),n}const Ie=(t,e)=>({key:t,pos:M(t),piece:e}),Jn=(t,e)=>e.sort((n,i)=>ve(t.pos,n.pos)-ve(t.pos,i.pos))[0];function Wn(t,e){const n=new Map,i=[],o=new Map,r=[],c=[],s=new Map;let l,a,g;for(const[d,f]of t)s.set(d,Ie(d,f));for(const d of Ve)l=e.pieces.get(d),a=s.get(d),l?a?Fe(l,a.piece)||(r.push(a),c.push(Ie(d,l))):c.push(Ie(d,l)):a&&r.push(a);for(const d of c)a=Jn(d,r.filter(f=>Fe(d.piece,f.piece))),a&&(g=[a.pos[0]-d.pos[0],a.pos[1]-d.pos[1]],n.set(d.key,g.concat(g)),i.push(a.key));for(const d of r)i.includes(d.key)||o.set(d.key,d.piece);return{anims:n,fadings:o}}function Qt(t,e){const n=t.animation.current;if(n===void 0){t.dom.destroyed||t.dom.redrawNow();return}const i=1-(e-n.start)*n.frequency;if(i<=0)t.animation.current=void 0,t.dom.redrawNow();else{const o=Vn(i);for(const r of n.plan.anims.values())r[2]=r[0]*o,r[3]=r[1]*o;t.dom.redrawNow(!0),requestAnimationFrame((r=performance.now())=>Qt(t,r))}}function Gn(t,e){const n=new Map(e.pieces),i=t(e),o=Wn(n,e);if(o.anims.size||o.fadings.size){const r=e.animation.current&&e.animation.current.start;e.animation.current={start:performance.now(),frequency:1/e.animation.duration,plan:o},r||Qt(e,performance.now())}else e.dom.redraw();return i}const Vn=t=>t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1,zn=["green","red","blue","yellow"];function Zn(t,e){if(e.touches&&e.touches.length>1)return;e.stopPropagation(),e.preventDefault(),e.ctrlKey?U(t):et(t);const n=le(e),i=ue(n,D(t),t.dom.bounds());i&&(t.drawable.current={orig:i,pos:n,brush:ei(e),snapToValidMove:t.drawable.defaultSnapToValidMove},Ut(t))}function Ut(t){requestAnimationFrame(()=>{const e=t.drawable.current;if(e){const n=ue(e.pos,D(t),t.dom.bounds());n||(e.snapToValidMove=!1);const i=e.snapToValidMove?jn(e.orig,e.pos,D(t),t.dom.bounds()):n;i!==e.mouseSq&&(e.mouseSq=i,e.dest=i!==e.orig?i:void 0,t.dom.redrawNow()),Ut(t)}})}function Yn(t,e){t.drawable.current&&(t.drawable.current.pos=le(e))}function Xn(t){const e=t.drawable.current;e&&(e.mouseSq&&ti(t.drawable,e),Ht(t))}function Ht(t){t.drawable.current&&(t.drawable.current=void 0,t.dom.redraw())}function $n(t){t.drawable.shapes.length&&(t.drawable.shapes=[],t.dom.redraw(),Jt(t.drawable))}function ei(t){var e;const n=(t.shiftKey||t.ctrlKey)&&Pt(t),i=t.altKey||t.metaKey||((e=t.getModifierState)===null||e===void 0?void 0:e.call(t,"AltGraph"));return zn[(n?1:0)+(i?2:0)]}function ti(t,e){const n=o=>o.orig===e.orig&&o.dest===e.dest,i=t.shapes.find(n);i&&(t.shapes=t.shapes.filter(o=>!n(o))),(!i||i.brush!==e.brush)&&t.shapes.push({orig:e.orig,dest:e.dest,brush:e.brush}),Jt(t)}function Jt(t){t.onChange&&t.onChange(t.shapes)}function ni(t,e){if(!e.isTrusted||e.button!==void 0&&e.button!==0||e.touches&&e.touches.length>1)return;const n=t.dom.bounds(),i=le(e),o=ue(i,D(t),n);if(!o)return;const r=t.pieces.get(o),c=t.selected;!c&&t.drawable.enabled&&(t.drawable.eraseOnClick||!r||r.color!==t.turnColor)&&$n(t),e.cancelable!==!1&&(!e.touches||t.blockTouchScroll||r||c||ii(t,i))&&e.preventDefault();const s=!!t.premovable.current,l=!!t.predroppable.current;t.stats.ctrlKey=e.ctrlKey,t.selected&&Xe(t,t.selected,o)?se(d=>Be(d,o),t):Be(t,o);const a=t.selected===o,g=Gt(t,o);if(r&&g&&a&&Ln(t,o)){t.draggable.current={orig:o,piece:r,origPos:i,pos:i,started:t.draggable.autoDistance&&t.stats.dragged,element:g,previouslySelected:c,originTarget:e.target,keyHasChanged:!1},g.cgDragging=!0,g.classList.add("dragging");const d=t.dom.elements.ghost;d&&(d.className=`ghost ${r.color} ${r.role}`,W(d,we(n)(M(o),D(t))),Ze(d,!0)),nt(t)}else s&&ie(t),l&&oe(t);t.dom.redraw()}function ii(t,e){const n=D(t),i=t.dom.bounds(),o=Math.pow(i.width/8,2);for(const r of t.pieces.keys()){const c=Et(r,n,i);if(ve(c,e)<=o)return!0}return!1}function oi(t,e,n,i){const o="a0";t.pieces.set(o,e),t.dom.redraw();const r=le(n);t.draggable.current={orig:o,piece:e,origPos:r,pos:r,started:!0,element:()=>Gt(t,o),originTarget:n.target,newPiece:!0,force:!!i,keyHasChanged:!1},nt(t)}function nt(t){requestAnimationFrame(()=>{var e;const n=t.draggable.current;if(!n)return;!((e=t.animation.current)===null||e===void 0)&&e.plan.anims.has(n.orig)&&(t.animation.current=void 0);const i=t.pieces.get(n.orig);if(!i||!Fe(i,n.piece))Pe(t);else if(!n.started&&ve(n.pos,n.origPos)>=Math.pow(t.draggable.distance,2)&&(n.started=!0),n.started){if(typeof n.element=="function"){const r=n.element();if(!r)return;r.cgDragging=!0,r.classList.add("dragging"),n.element=r}const o=t.dom.bounds();W(n.element,[n.pos[0]-o.left-o.width/16,n.pos[1]-o.top-o.height/16]),n.keyHasChanged||(n.keyHasChanged=n.orig!==ue(n.pos,D(t),o))}nt(t)})}function ri(t,e){t.draggable.current&&(!e.touches||e.touches.length<2)&&(t.draggable.current.pos=le(e))}function si(t,e){const n=t.draggable.current;if(!n)return;if(e.type==="touchend"&&e.cancelable!==!1&&e.preventDefault(),e.type==="touchend"&&n.originTarget!==e.target&&!n.newPiece){t.draggable.current=void 0;return}ie(t),oe(t);const i=le(e)||n.pos,o=ue(i,D(t),t.dom.bounds());o&&n.started&&n.orig!==o?n.newPiece?Dt(t,n.orig,o,n.force):(t.stats.ctrlKey=e.ctrlKey,qt(t,n.orig,o)&&(t.stats.dragged=!0)):n.newPiece?t.pieces.delete(n.orig):t.draggable.deleteOnDropOff&&!o&&(t.pieces.delete(n.orig),q(t.events.change)),(n.orig===n.previouslySelected||n.keyHasChanged)&&(n.orig===o||!o)?U(t):t.selectable.enabled||U(t),Wt(t),t.draggable.current=void 0,t.dom.redraw()}function Pe(t){const e=t.draggable.current;e&&(e.newPiece&&t.pieces.delete(e.orig),t.draggable.current=void 0,U(t),Wt(t),t.dom.redraw())}function Wt(t){const e=t.dom.elements;e.ghost&&Ze(e.ghost,!1)}function Gt(t,e){let n=t.dom.elements.board.firstChild;for(;n;){if(n.cgKey===e&&n.tagName==="PIECE")return n;n=n.nextSibling}}function ci(t,e){t.exploding={stage:1,keys:e},t.dom.redraw(),setTimeout(()=>{at(t,2),setTimeout(()=>at(t,void 0),120)},120)}function at(t,e){t.exploding&&(e?t.exploding.stage=e:t.exploding=void 0,t.dom.redraw())}function ai(t,e){function n(){Tn(t),e()}return{set(i){i.orientation&&i.orientation!==t.orientation&&n(),Bt(t,i),(i.fen?se:ee)(o=>jt(o,i),t)},state:t,getFen:()=>Hn(t.pieces),toggleOrientation:n,setPieces(i){se(o=>Nn(o,i),t)},selectSquare(i,o){i?se(r=>Be(r,i,o),t):t.selected&&(U(t),t.dom.redraw())},move(i,o){se(r=>It(r,i,o),t)},newPiece(i,o){se(r=>Ye(r,i,o),t)},playPremove(){if(t.premovable.current){if(se(Fn,t))return!0;t.dom.redraw()}return!1},playPredrop(i){if(t.predroppable.current){const o=Bn(t,i);return t.dom.redraw(),o}return!1},cancelPremove(){ee(ie,t)},cancelPredrop(){ee(oe,t)},cancelMove(){ee(i=>{et(i),Pe(i)},t)},stop(){ee(i=>{st(i),Pe(i)},t)},explode(i){ci(t,i)},setAutoShapes(i){ee(o=>o.drawable.autoShapes=i,t)},setShapes(i){ee(o=>o.drawable.shapes=i,t)},getKeyAtDomPos(i){return ue(i,D(t),t.dom.bounds())},redrawAll:e,dragNewPiece(i,o,r){oi(t,i,o,r)},destroy(){st(t),t.dom.unbind&&t.dom.unbind(),t.dom.destroyed=!0}}}function li(){return{pieces:Ft(Lt),orientation:"white",turnColor:"white",coordinates:!0,ranksPosition:"right",autoCastle:!0,viewOnly:!1,disableContextMenu:!1,addPieceZIndex:!1,blockTouchScroll:!1,pieceKey:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15}},prevSvgHash:""},hold:Pn()}}function je(t,e,n){const i=new Map,o=[];for(const s of t)i.set(s.hash,!1);let r=e.firstChild,c;for(;r;)c=r.getAttribute("cgHash"),i.has(c)?i.set(c,!0):o.push(r),r=r.nextSibling;for(const s of o)e.removeChild(s);for(const s of t)i.get(s.hash)||e.appendChild(n(s))}function Q(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function ui(t,e,n){const i=t.drawable,o=i.current,r=o&&o.mouseSq?o:void 0,c=new Map,s=t.dom.bounds(),l=i.autoShapes.filter(h=>!h.piece);for(const h of i.shapes.concat(l).concat(r?[r]:[]))h.dest&&c.set(h.dest,(c.get(h.dest)||0)+1);const a=i.shapes.concat(l).map(h=>({shape:h,current:!1,hash:lt(h,c,!1,s)}));r&&a.push({shape:r,current:!0,hash:lt(r,c,!0,s)});const g=a.map(h=>h.hash).join(";");if(g===t.drawable.prevSvgHash)return;t.drawable.prevSvgHash=g;const d=e.querySelector("defs"),f=e.querySelector("g"),w=n.querySelector("g");fi(i,a,d),je(a.filter(h=>!h.shape.customSvg),f,h=>ut(t,h,i.brushes,c,s)),je(a.filter(h=>h.shape.customSvg),w,h=>ut(t,h,i.brushes,c,s))}function fi(t,e,n){var i;const o=new Map;let r;for(const l of e)l.shape.dest&&(r=t.brushes[l.shape.brush],l.shape.modifiers&&(r=Vt(r,l.shape.modifiers)),!((i=l.shape.modifiers)===null||i===void 0)&&i.hilite&&o.set("hilite",{key:"hilite",color:"white",opacity:1,lineWidth:1}),o.set(r.key,r));const c=new Set;let s=n.firstChild;for(;s;)c.add(s.getAttribute("cgKey")),s=s.nextSibling;for(const[l,a]of o.entries())c.has(l)||n.appendChild(vi(a))}function lt({orig:t,dest:e,brush:n,piece:i,modifiers:o,customSvg:r},c,s,l){return[l.width,l.height,s,t,e,n,e&&(c.get(e)||0)>1,i&&hi(i),o&&di(o),r&&gi(r)].filter(a=>a).join(",")}function hi(t){return[t.color,t.role,t.scale].filter(e=>e).join(",")}function di(t){return[t.lineWidth,t.hilite].filter(e=>e).join(",")}function gi(t){let e=0;for(let n=0;n<t.length;n++)e=(e<<5)-e+t.charCodeAt(n)>>>0;return"custom-"+e.toString()}function ut(t,{shape:e,current:n,hash:i},o,r,c){var s;let l;const a=ft(M(e.orig),t.orientation);if(e.customSvg)l=pi(e.customSvg,a,c);else if(e.dest&&e.dest!=e.orig){let g=o[e.brush];e.modifiers&&(g=Vt(g,e.modifiers)),l=bi(g,a,ft(M(e.dest),t.orientation),n,(r.get(e.dest)||0)>1,c,(s=e.modifiers)===null||s===void 0?void 0:s.hilite)}else l=mi(o[e.brush],a,n,c);return l.setAttribute("cgHash",i),l}function pi(t,e,n){const[i,o]=Ee(e,n),r=ne(Q("g"),{transform:`translate(${i},${o})`}),c=ne(Q("svg"),{width:1,height:1,viewBox:"0 0 100 100"});return r.appendChild(c),c.innerHTML=t,r}function mi(t,e,n,i){const o=Ee(e,i),r=_i(),c=(i.width+i.height)/(4*Math.max(i.width,i.height));return ne(Q("circle"),{stroke:t.color,"stroke-width":r[n?0:1],fill:"none",opacity:zt(t,n),cx:o[0],cy:o[1],r:c-r[1]/2})}function bi(t,e,n,i,o,r,c=!1){function s(a){const g=ki(o&&!i),d=Ee(e,r),f=Ee(n,r),w=f[0]-d[0],h=f[1]-d[1],u=Math.atan2(h,w),k=Math.cos(u)*g,m=Math.sin(u)*g;return ne(Q("line"),{stroke:a?"white":t.color,"stroke-width":wi(t,i)+(a?.04:0),"stroke-linecap":"round","marker-end":`url(#arrowhead-${a?"hilite":t.key})`,opacity:a?1:zt(t,i),x1:d[0],y1:d[1],x2:f[0]-k,y2:f[1]-m})}const l=c?Q("g"):s(!1);return c&&[!0,!1].map(a=>l.appendChild(s(a))),l}function vi(t){const e=ne(Q("marker"),{id:"arrowhead-"+t.key,orient:"auto",markerWidth:4,markerHeight:8,refX:t.key==="hilite"?1.86:2.05,refY:2});return e.appendChild(ne(Q("path"),{d:"M0,0 V4 L3,2 Z",fill:t.color})),e.setAttribute("cgKey",t.key),e}function ne(t,e){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.setAttribute(n,e[n]);return t}function ft(t,e){return e==="white"?t:[7-t[0],7-t[1]]}function Vt(t,e){return{color:t.color,opacity:Math.round(t.opacity*10)/10,lineWidth:Math.round(e.lineWidth||t.lineWidth),key:[t.key,e.lineWidth].filter(n=>n).join("")}}function _i(){return[3/64,4/64]}function wi(t,e){return(t.lineWidth||10)*(e?.85:1)/64}function zt(t,e){return(t.opacity||1)*(e?.9:1)}function ki(t){return(t?20:10)/64}function Ee(t,e){const n=Math.min(1,e.width/e.height),i=Math.min(1,e.height/e.width);return[(t[0]-3.5)*n,(3.5-t[1])*i]}function yi(t,e){t.innerHTML="",t.classList.add("cg-wrap");for(const l of yn)t.classList.toggle("orientation-"+l,e.orientation===l);t.classList.toggle("manipulable",!e.viewOnly);const n=V("cg-container");t.appendChild(n);const i=V("cg-board");n.appendChild(i);let o,r,c;if(e.drawable.visible&&(o=ne(Q("svg"),{class:"cg-shapes",viewBox:"-4 -4 8 8",preserveAspectRatio:"xMidYMid slice"}),o.appendChild(Q("defs")),o.appendChild(Q("g")),r=ne(Q("svg"),{class:"cg-custom-svgs",viewBox:"-3.5 -3.5 8 8",preserveAspectRatio:"xMidYMid slice"}),r.appendChild(Q("g")),c=V("cg-auto-pieces"),n.appendChild(o),n.appendChild(r),n.appendChild(c)),e.coordinates){const l=e.orientation==="black"?" black":"",a=e.ranksPosition==="left"?" left":"";n.appendChild(ht(Ge,"ranks"+l+a)),n.appendChild(ht(We,"files"+l))}let s;return e.draggable.enabled&&e.draggable.showGhost&&(s=V("piece","ghost"),Ze(s,!1),n.appendChild(s)),{board:i,container:n,wrap:t,ghost:s,svg:o,customSvg:r,autoPieces:c}}function ht(t,e){const n=V("coords",e);let i;for(const o of t)i=V("coord"),i.textContent=o,n.appendChild(i);return n}function Si(t,e){if(!t.dropmode.active)return;ie(t),oe(t);const n=t.dropmode.piece;if(n){t.pieces.set("a0",n);const i=le(e),o=i&&ue(i,D(t),t.dom.bounds());o&&Dt(t,"a0",o)}t.dom.redraw()}function Ci(t,e){const n=t.dom.elements.board;if("ResizeObserver"in window&&new ResizeObserver(e).observe(t.dom.elements.wrap),(t.disableContextMenu||t.drawable.enabled)&&n.addEventListener("contextmenu",o=>o.preventDefault()),t.viewOnly)return;const i=Ei(t);n.addEventListener("touchstart",i,{passive:!1}),n.addEventListener("mousedown",i,{passive:!1})}function Pi(t,e){const n=[];if("ResizeObserver"in window||n.push(fe(document.body,"chessground.resize",e)),!t.viewOnly){const i=dt(t,ri,Yn),o=dt(t,si,Xn);for(const c of["touchmove","mousemove"])n.push(fe(document,c,i));for(const c of["touchend","mouseup"])n.push(fe(document,c,o));const r=()=>t.dom.bounds.clear();n.push(fe(document,"scroll",r,{capture:!0,passive:!0})),n.push(fe(window,"resize",r,{passive:!0}))}return()=>n.forEach(i=>i())}function fe(t,e,n,i){return t.addEventListener(e,n,i),()=>t.removeEventListener(e,n,i)}const Ei=t=>e=>{t.draggable.current?Pe(t):t.drawable.current?Ht(t):e.shiftKey||Pt(e)?t.drawable.enabled&&Zn(t,e):t.viewOnly||(t.dropmode.active?Si(t,e):ni(t,e))},dt=(t,e,n)=>i=>{t.drawable.current?t.drawable.enabled&&n(t,i):t.viewOnly||e(t,i)};function Mi(t){const e=D(t),n=we(t.dom.bounds()),i=t.dom.elements.board,o=t.pieces,r=t.animation.current,c=r?r.plan.anims:new Map,s=r?r.plan.fadings:new Map,l=t.draggable.current,a=Ti(t),g=new Set,d=new Set,f=new Map,w=new Map;let h,u,k,m,P,p,S,E,H,J;for(u=i.firstChild;u;){if(h=u.cgKey,Zt(u))if(k=o.get(h),P=c.get(h),p=s.get(h),m=u.cgPiece,u.cgDragging&&(!l||l.orig!==h)&&(u.classList.remove("dragging"),W(u,n(M(h),e)),u.cgDragging=!1),!p&&u.cgFading&&(u.cgFading=!1,u.classList.remove("fading")),k){if(P&&u.cgAnimating&&m===he(k)){const C=M(h);C[0]+=P[2],C[1]+=P[3],u.classList.add("anim"),W(u,n(C,e))}else u.cgAnimating&&(u.cgAnimating=!1,u.classList.remove("anim"),W(u,n(M(h),e)),t.addPieceZIndex&&(u.style.zIndex=xe(M(h),e)));m===he(k)&&(!p||!u.cgFading)?g.add(h):p&&m===he(p)?(u.classList.add("fading"),u.cgFading=!0):qe(f,m,u)}else qe(f,m,u);else if(Yt(u)){const C=u.className;a.get(h)===C?d.add(h):qe(w,C,u)}u=u.nextSibling}for(const[C,L]of a)if(!d.has(C)){H=w.get(L),J=H&&H.pop();const O=n(M(C),e);if(J)J.cgKey=C,W(J,O);else{const I=V("square",L);I.cgKey=C,W(I,O),i.insertBefore(I,i.firstChild)}}for(const[C,L]of o)if(P=c.get(C),!g.has(C))if(S=f.get(he(L)),E=S&&S.pop(),E){E.cgKey=C,E.cgFading&&(E.classList.remove("fading"),E.cgFading=!1);const O=M(C);t.addPieceZIndex&&(E.style.zIndex=xe(O,e)),P&&(E.cgAnimating=!0,E.classList.add("anim"),O[0]+=P[2],O[1]+=P[3]),W(E,n(O,e))}else{const O=he(L),I=V("piece",O),Z=M(C);I.cgPiece=O,I.cgKey=C,P&&(I.cgAnimating=!0,Z[0]+=P[2],Z[1]+=P[3]),W(I,n(Z,e)),t.addPieceZIndex&&(I.style.zIndex=xe(Z,e)),i.appendChild(I)}for(const C of f.values())pt(t,C);for(const C of w.values())pt(t,C)}function Ai(t){const e=D(t),n=we(t.dom.bounds());let i=t.dom.elements.board.firstChild;for(;i;)(Zt(i)&&!i.cgAnimating||Yt(i))&&W(i,n(M(i.cgKey),e)),i=i.nextSibling}function gt(t){var e,n;const i=t.dom.elements.wrap.getBoundingClientRect(),o=t.dom.elements.container,r=i.height/i.width,c=Math.floor(i.width*window.devicePixelRatio/8)*8/window.devicePixelRatio,s=c*r;o.style.width=c+"px",o.style.height=s+"px",t.dom.bounds.clear(),(e=t.addDimensionsCssVarsTo)===null||e===void 0||e.style.setProperty("--cg-width",c+"px"),(n=t.addDimensionsCssVarsTo)===null||n===void 0||n.style.setProperty("--cg-height",s+"px")}const Zt=t=>t.tagName==="PIECE",Yt=t=>t.tagName==="SQUARE";function pt(t,e){for(const n of e)t.dom.elements.board.removeChild(n)}function xe(t,e){const i=t[1];return`${e?3+7-i:3+i}`}const he=t=>`${t.color} ${t.role}`;function Ti(t){var e;const n=new Map;if(t.lastMove&&t.highlight.lastMove)for(const r of t.lastMove)Y(n,r,"last-move");if(t.check&&t.highlight.check&&Y(n,t.check,"check"),t.selected&&(Y(n,t.selected,"selected"),t.movable.showDests)){const r=(e=t.movable.dests)===null||e===void 0?void 0:e.get(t.selected);if(r)for(const s of r)Y(n,s,"move-dest"+(t.pieces.has(s)?" oc":""));const c=t.premovable.dests;if(c)for(const s of c)Y(n,s,"premove-dest"+(t.pieces.has(s)?" oc":""))}const i=t.premovable.current;if(i)for(const r of i)Y(n,r,"current-premove");else t.predroppable.current&&Y(n,t.predroppable.current.key,"current-premove");const o=t.exploding;if(o)for(const r of o.keys)Y(n,r,"exploding"+o.stage);return n}function Y(t,e,n){const i=t.get(e);i?t.set(e,`${i} ${n}`):t.set(e,n)}function qe(t,e,n){const i=t.get(e);i?i.push(n):t.set(e,[n])}function Ni(t,e){const i=t.drawable.autoShapes.filter(o=>o.piece).map(o=>({shape:o,hash:xi(o),current:!1}));je(i,e,o=>Ii(t,o,t.dom.bounds()))}function Oi(t){var e;const n=D(t),i=we(t.dom.bounds());let o=(e=t.dom.elements.autoPieces)===null||e===void 0?void 0:e.firstChild;for(;o;)Ct(o,i(M(o.cgKey),n),o.cgScale),o=o.nextSibling}function Ii(t,{shape:e,hash:n},i){var o,r,c;const s=e.orig,l=(o=e.piece)===null||o===void 0?void 0:o.role,a=(r=e.piece)===null||r===void 0?void 0:r.color,g=(c=e.piece)===null||c===void 0?void 0:c.scale,d=V("piece",`${l} ${a}`);return d.setAttribute("cgHash",n),d.cgKey=s,d.cgScale=g,Ct(d,we(i)(M(s),D(t)),g),d}const xi=t=>{var e,n,i;return[t.orig,(e=t.piece)===null||e===void 0?void 0:e.role,(n=t.piece)===null||n===void 0?void 0:n.color,(i=t.piece)===null||i===void 0?void 0:i.scale].join(",")};function qi(t,e){const n=li();jt(n,e||{});function i(){const o="dom"in n?n.dom.unbind:void 0,r=yi(t,n),c=Cn(()=>r.board.getBoundingClientRect()),s=g=>{Mi(a),r.autoPieces&&Ni(a,r.autoPieces),!g&&r.svg&&ui(a,r.svg,r.customSvg)},l=()=>{gt(a),Ai(a),r.autoPieces&&Oi(a)},a=n;return a.dom={elements:r,bounds:c,redraw:Di(s),redrawNow:s,unbind:o},a.drawable.prevSvgHash="",gt(a),s(!1),Ci(a,l),o||(a.dom.unbind=Pi(a,l)),a.events.insert&&a.events.insert(r),a}return ai(i(),i)}function Di(t){let e=!1;return()=>{e||(e=!0,requestAnimationFrame(()=>{t(),e=!1}))}}function Ri(t){let e,n;return{c(){e=pe("div"),this.h()},l(i){e=me(i,"DIV",{class:!0}),be(e).forEach(z),this.h()},h(){G(e,"class",n="cg-wrap "+t[0]+" svelte-d0p6kd")},m(i,o){Me(i,e,o),t[36](e)},p(i,o){o[0]&1&&n!==(n="cg-wrap "+i[0]+" svelte-d0p6kd")&&G(e,"class",n)},i:Ce,o:Ce,d(i){i&&z(e),t[36](null)}}}function Ki(t,e,n){let{class:i="cg-default-style"}=e,{fen:o=void 0}=e,{orientation:r=void 0}=e,{turnColor:c=void 0}=e,{check:s=void 0}=e,{lastMove:l=void 0}=e,{selected:a=void 0}=e,{coordinates:g=void 0}=e,{autoCastle:d=void 0}=e,{viewOnly:f=void 0}=e,{disableContextMenu:w=void 0}=e,{addPieceZIndex:h=void 0}=e,{addDimensionsCssVarsTo:u=void 0}=e,{blockTouchScroll:k=void 0}=e,{config:m={}}=e,P,p;yt(async()=>{r!==void 0&&n(2,m.orientation=r,m),o!==void 0&&n(2,m.fen=o,m),c!==void 0&&n(2,m.turnColor=c,m),s!==void 0&&n(2,m.check=s,m),l!==void 0&&n(2,m.lastMove=l,m),a!==void 0&&n(2,m.selected=a,m),g!==void 0&&n(2,m.coordinates=g,m),d!==void 0&&n(2,m.autoCastle=d,m),f!==void 0&&n(2,m.viewOnly=f,m),w!==void 0&&n(2,m.disableContextMenu=w,m),h!==void 0&&n(2,m.addPieceZIndex=h,m),u!==void 0&&n(2,m.addDimensionsCssVarsTo=u,m),k!==void 0&&n(2,m.blockTouchScroll=k,m),p=qi(P,m)});function S(b){p&&p.set(b)}function E(b){p.set(b)}function H(){return p.state}function J(){return p.getFen()}function C(){return p.toggleOrientation()}function L(b,re){return p.move(b,re)}function O(b){return p.setPieces(b)}function I(b,re){return p.selectSquare(b,re)}function Z(b,re){return p.newPiece(b,re)}function Ae(){return p.playPremove()}function v(){p.cancelPremove()}function Te(b){return p.playPredrop(b)}function Ne(){p.cancelPredrop()}function Oe(){p.cancelMove()}function $t(){p.stop()}function en(b){p.explode(b)}function tn(b){p.setShapes(b)}function nn(b){p.setAutoShapes(b)}function on(){return p.redrawAll()}function rn(b,re,an){p.dragNewPiece(b,re,an)}function sn(){return p.destroy()}function cn(b){Le[b?"unshift":"push"](()=>{P=b,n(1,P)})}return t.$$set=b=>{"class"in b&&n(0,i=b.class),"fen"in b&&n(3,o=b.fen),"orientation"in b&&n(4,r=b.orientation),"turnColor"in b&&n(5,c=b.turnColor),"check"in b&&n(6,s=b.check),"lastMove"in b&&n(7,l=b.lastMove),"selected"in b&&n(8,a=b.selected),"coordinates"in b&&n(9,g=b.coordinates),"autoCastle"in b&&n(10,d=b.autoCastle),"viewOnly"in b&&n(11,f=b.viewOnly),"disableContextMenu"in b&&n(12,w=b.disableContextMenu),"addPieceZIndex"in b&&n(13,h=b.addPieceZIndex),"addDimensionsCssVarsTo"in b&&n(14,u=b.addDimensionsCssVarsTo),"blockTouchScroll"in b&&n(15,k=b.blockTouchScroll),"config"in b&&n(2,m=b.config)},t.$$.update=()=>{t.$$.dirty[0]&8&&S({fen:o}),t.$$.dirty[0]&16&&S({orientation:r}),t.$$.dirty[0]&32&&S({turnColor:c}),t.$$.dirty[0]&64&&S({check:s}),t.$$.dirty[0]&128&&S({lastMove:l}),t.$$.dirty[0]&256&&S({selected:a}),t.$$.dirty[0]&512&&S({coordinates:g}),t.$$.dirty[0]&1024&&S({autoCastle:d}),t.$$.dirty[0]&2048&&S({viewOnly:f}),t.$$.dirty[0]&4096&&S({disableContextMenu:w}),t.$$.dirty[0]&8192&&S({addPieceZIndex:h}),t.$$.dirty[0]&16384&&S({addDimensionsCssVarsTo:u}),t.$$.dirty[0]&32768&&S({blockTouchScroll:k}),t.$$.dirty[0]&4&&S(m)},[i,P,m,o,r,c,s,l,a,g,d,f,w,h,u,k,E,H,J,C,L,O,I,Z,Ae,v,Te,Ne,Oe,$t,en,tn,nn,on,rn,sn,cn]}class Li extends Ue{constructor(e){super(),He(this,e,Ki,Ri,Je,{class:0,fen:3,orientation:4,turnColor:5,check:6,lastMove:7,selected:8,coordinates:9,autoCastle:10,viewOnly:11,disableContextMenu:12,addPieceZIndex:13,addDimensionsCssVarsTo:14,blockTouchScroll:15,config:2,set:16,getState:17,getFen:18,toggleOrientation:19,move:20,setPieces:21,selectSquare:22,newPiece:23,playPremove:24,cancelPremove:25,playPredrop:26,cancelPredrop:27,cancelMove:28,stop:29,explode:30,setShapes:31,setAutoShapes:32,redrawAll:33,dragNewPiece:34,destroy:35},null,[-1,-1])}get set(){return this.$$.ctx[16]}get getState(){return this.$$.ctx[17]}get getFen(){return this.$$.ctx[18]}get toggleOrientation(){return this.$$.ctx[19]}get move(){return this.$$.ctx[20]}get setPieces(){return this.$$.ctx[21]}get selectSquare(){return this.$$.ctx[22]}get newPiece(){return this.$$.ctx[23]}get playPremove(){return this.$$.ctx[24]}get cancelPremove(){return this.$$.ctx[25]}get playPredrop(){return this.$$.ctx[26]}get cancelPredrop(){return this.$$.ctx[27]}get cancelMove(){return this.$$.ctx[28]}get stop(){return this.$$.ctx[29]}get explode(){return this.$$.ctx[30]}get setShapes(){return this.$$.ctx[31]}get setAutoShapes(){return this.$$.ctx[32]}get redrawAll(){return this.$$.ctx[33]}get dragNewPiece(){return this.$$.ctx[34]}get destroy(){return this.$$.ctx[35]}}function mt(t,e,n){const i=t.slice();i[12]=e[n],i[16]=n;const o=i[4]&&i[0]==="w"||i[5]&&i[0]==="b";i[13]=o;const r=i[13]?i[16]*12.5:100-12.5*(i[16]+1);return i[14]=r,i}function bt(t){let e,n,i,o,r;function c(){return t[10](t[12])}function s(...l){return t[11](t[12],...l)}return{c(){e=pe("div"),n=pe("div"),i=hn(),this.h()},l(l){e=me(l,"DIV",{class:!0,style:!0});var a=be(e);n=me(a,"DIV",{class:!0,role:!0,tabindex:!0,"aria-label":!0}),be(n).forEach(z),i=dn(a),a.forEach(z),this.h()},h(){G(n,"class","piece "+t[12]+" svelte-1692twp"),G(n,"role","button"),G(n,"tabindex","0"),G(n,"aria-label","Promote to "+t[7][t[12]]),it(n,"white",t[4]),it(n,"black",t[5]),G(e,"class","square svelte-1692twp"),ye(e,"margin-left",t[3]+"%"),ye(e,"margin-top",t[14]+"%")},m(l,a){Me(l,e,a),ot(e,n),ot(e,i),o||(r=[rt(n,"click",c),rt(n,"keydown",s)],o=!0)},p(l,a){t=l,a&1&&ye(e,"margin-top",t[14]+"%")},d(l){l&&z(e),o=!1,gn(r)}}}function Fi(t){let e,n,i=t[6],o=[];for(let r=0;r<i.length;r+=1)o[r]=bt(mt(t,i,r));return{c(){e=pe("div");for(let r=0;r<o.length;r+=1)o[r].c();this.h()},l(r){e=me(r,"DIV",{class:!0});var c=be(e);for(let s=0;s<o.length;s+=1)o[s].l(c);c.forEach(z),this.h()},h(){G(e,"class",n="dialog "+t[2]+" svelte-1692twp")},m(r,c){Me(r,e,c);for(let s=0;s<o.length;s+=1)o[s]&&o[s].m(e,null)},p(r,[c]){if(c&507){i=r[6];let s;for(s=0;s<i.length;s+=1){const l=mt(r,i,s);o[s]?o[s].p(l,c):(o[s]=bt(l),o[s].c(),o[s].m(e,null))}for(;s<o.length;s+=1)o[s].d(1);o.length=i.length}c&4&&n!==(n="dialog "+r[2]+" svelte-1692twp")&&G(e,"class",n)},i:Ce,o:Ce,d(r){r&&z(e),fn(o,r)}}}function vt(t){return t.charCodeAt(0)-97}function Bi(t,e,n){let{square:i}=e,{orientation:o="w"}=e,{callback:r}=e,{class:c=void 0}=e;const s=100/8*(o==="w"?vt(i):7-vt(i)),l=i.charAt(1)==="8",a=!l,g=["q","n","r","b"],d={q:"queen",n:"knight",r:"rook",b:"bishop",p:"pawn",k:"king"};function f(u,k){(u.key==="Enter"||u.key===" ")&&r(k)}const w=u=>r(u),h=(u,k)=>f(k,u);return t.$$set=u=>{"square"in u&&n(9,i=u.square),"orientation"in u&&n(0,o=u.orientation),"callback"in u&&n(1,r=u.callback),"class"in u&&n(2,c=u.class)},[o,r,c,s,l,a,g,d,f,i,w,h]}class ji extends Ue{constructor(e){super(),He(this,e,Bi,Fi,Je,{square:9,orientation:0,callback:1,class:2})}}/**
 * @license
 * Copyright (c) 2023, Jeff Hlywa (jhlywa@gmail.com)
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice,
 *    this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 * POSSIBILITY OF SUCH DAMAGE.
 */const N="w",F="b",A="p",Qe="n",Se="b",ge="r",te="q",T="k",De="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",R=-1,Qi={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},Ui=["a8","b8","c8","d8","e8","f8","g8","h8","a7","b7","c7","d7","e7","f7","g7","h7","a6","b6","c6","d6","e6","f6","g6","h6","a5","b5","c5","d5","e5","f5","g5","h5","a4","b4","c4","d4","e4","f4","g4","h4","a3","b3","c3","d3","e3","f3","g3","h3","a2","b2","c2","d2","e2","f2","g2","h2","a1","b1","c1","d1","e1","f1","g1","h1"],_={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},y={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},Re={b:[16,32,17,15],w:[-16,-32,-17,-15]},_t={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},Hi=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],Ji=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],Wi={p:1,n:2,b:4,r:8,q:16,k:32},Gi="pnbrqkPNBRQK",wt=[Qe,Se,ge,te],Vi=7,zi=6,Zi=1,Yi=0,ke={[T]:_.KSIDE_CASTLE,[te]:_.QSIDE_CASTLE},X={w:[{square:y.a1,flag:_.QSIDE_CASTLE},{square:y.h1,flag:_.KSIDE_CASTLE}],b:[{square:y.a8,flag:_.QSIDE_CASTLE},{square:y.h8,flag:_.KSIDE_CASTLE}]},Xi={b:Zi,w:zi},$i=["1-0","0-1","1/2-1/2","*"];function ce(t){return t>>4}function _e(t){return t&15}function Xt(t){return"0123456789".indexOf(t)!==-1}function K(t){const e=_e(t),n=ce(t);return"abcdefgh".substring(e,e+1)+"87654321".substring(n,n+1)}function de(t){return t===N?F:N}function eo(t){const e=t.split(/\s+/);if(e.length!==6)return{ok:!1,error:"Invalid FEN: must contain six space-delimited fields"};const n=parseInt(e[5],10);if(isNaN(n)||n<=0)return{ok:!1,error:"Invalid FEN: move number must be a positive integer"};const i=parseInt(e[4],10);if(isNaN(i)||i<0)return{ok:!1,error:"Invalid FEN: half move counter number must be a non-negative integer"};if(!/^(-|[abcdefgh][36])$/.test(e[3]))return{ok:!1,error:"Invalid FEN: en-passant square is invalid"};if(/[^kKqQ-]/.test(e[2]))return{ok:!1,error:"Invalid FEN: castling availability is invalid"};if(!/^(w|b)$/.test(e[1]))return{ok:!1,error:"Invalid FEN: side-to-move is invalid"};const o=e[0].split("/");if(o.length!==8)return{ok:!1,error:"Invalid FEN: piece data does not contain 8 '/'-delimited rows"};for(let c=0;c<o.length;c++){let s=0,l=!1;for(let a=0;a<o[c].length;a++)if(Xt(o[c][a])){if(l)return{ok:!1,error:"Invalid FEN: piece data is invalid (consecutive number)"};s+=parseInt(o[c][a],10),l=!0}else{if(!/^[prnbqkPRNBQK]$/.test(o[c][a]))return{ok:!1,error:"Invalid FEN: piece data is invalid (invalid piece)"};s+=1,l=!1}if(s!==8)return{ok:!1,error:"Invalid FEN: piece data is invalid (too many squares in rank)"}}if(e[3][1]=="3"&&e[1]=="w"||e[3][1]=="6"&&e[1]=="b")return{ok:!1,error:"Invalid FEN: illegal en-passant square"};const r=[{color:"white",regex:/K/g},{color:"black",regex:/k/g}];for(const{color:c,regex:s}of r){if(!s.test(e[0]))return{ok:!1,error:`Invalid FEN: missing ${c} king`};if((e[0].match(s)||[]).length>1)return{ok:!1,error:`Invalid FEN: too many ${c} kings`}}return{ok:!0}}function to(t,e){const n=t.from,i=t.to,o=t.piece;let r=0,c=0,s=0;for(let l=0,a=e.length;l<a;l++){const g=e[l].from,d=e[l].to,f=e[l].piece;o===f&&n!==g&&i===d&&(r++,ce(n)===ce(g)&&c++,_e(n)===_e(g)&&s++)}return r>0?c>0&&s>0?K(n):s>0?K(n).charAt(1):K(n).charAt(0):""}function $(t,e,n,i,o,r=void 0,c=_.NORMAL){const s=ce(i);if(o===A&&(s===Vi||s===Yi))for(let l=0;l<wt.length;l++){const a=wt[l];t.push({color:e,from:n,to:i,piece:o,captured:r,promotion:a,flags:c|_.PROMOTION})}else t.push({color:e,from:n,to:i,piece:o,captured:r,flags:c})}function kt(t){let e=t.charAt(0);return e>="a"&&e<="h"?t.match(/[a-h]\d.*[a-h]\d/)?void 0:A:(e=e.toLowerCase(),e==="o"?T:e)}function Ke(t){return t.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}let no=class{constructor(e=De){x(this,"_board",new Array(128));x(this,"_turn",N);x(this,"_header",{});x(this,"_kings",{w:R,b:R});x(this,"_epSquare",-1);x(this,"_halfMoves",0);x(this,"_moveNumber",0);x(this,"_history",[]);x(this,"_comments",{});x(this,"_castling",{w:0,b:0});this.load(e)}clear(e=!1){this._board=new Array(128),this._kings={w:R,b:R},this._turn=N,this._castling={w:0,b:0},this._epSquare=R,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=e?this._header:{},this._updateSetup(this.fen())}removeHeader(e){e in this._header&&delete this._header[e]}load(e,n=!1){let i=e.split(/\s+/);if(i.length>=2&&i.length<6){const l=["-","-","0","1"];e=i.concat(l.slice(-(6-i.length))).join(" ")}i=e.split(/\s+/);const{ok:o,error:r}=eo(e);if(!o)throw new Error(r);const c=i[0];let s=0;this.clear(n);for(let l=0;l<c.length;l++){const a=c.charAt(l);if(a==="/")s+=8;else if(Xt(a))s+=parseInt(a,10);else{const g=a<"a"?N:F;this.put({type:a.toLowerCase(),color:g},K(s)),s++}}this._turn=i[1],i[2].indexOf("K")>-1&&(this._castling.w|=_.KSIDE_CASTLE),i[2].indexOf("Q")>-1&&(this._castling.w|=_.QSIDE_CASTLE),i[2].indexOf("k")>-1&&(this._castling.b|=_.KSIDE_CASTLE),i[2].indexOf("q")>-1&&(this._castling.b|=_.QSIDE_CASTLE),this._epSquare=i[3]==="-"?R:y[i[3]],this._halfMoves=parseInt(i[4],10),this._moveNumber=parseInt(i[5],10),this._updateSetup(this.fen())}fen(){var r,c;let e=0,n="";for(let s=y.a8;s<=y.h1;s++){if(this._board[s]){e>0&&(n+=e,e=0);const{color:l,type:a}=this._board[s];n+=l===N?a.toUpperCase():a.toLowerCase()}else e++;s+1&136&&(e>0&&(n+=e),s!==y.h1&&(n+="/"),e=0,s+=8)}let i="";this._castling[N]&_.KSIDE_CASTLE&&(i+="K"),this._castling[N]&_.QSIDE_CASTLE&&(i+="Q"),this._castling[F]&_.KSIDE_CASTLE&&(i+="k"),this._castling[F]&_.QSIDE_CASTLE&&(i+="q"),i=i||"-";let o="-";if(this._epSquare!==R){const s=this._epSquare+(this._turn===N?16:-16),l=[s+1,s-1];for(const a of l){if(a&136)continue;const g=this._turn;if(((r=this._board[a])==null?void 0:r.color)===g&&((c=this._board[a])==null?void 0:c.type)===A){this._makeMove({color:g,from:a,to:this._epSquare,piece:A,captured:A,flags:_.EP_CAPTURE});const d=!this._isKingAttacked(g);if(this._undoMove(),d){o=K(this._epSquare);break}}}}return[n,this._turn,i,o,this._halfMoves,this._moveNumber].join(" ")}_updateSetup(e){this._history.length>0||(e!==De?(this._header.SetUp="1",this._header.FEN=e):(delete this._header.SetUp,delete this._header.FEN))}reset(){this.load(De)}get(e){return this._board[y[e]]||!1}put({type:e,color:n},i){if(Gi.indexOf(e.toLowerCase())===-1||!(i in y))return!1;const o=y[i];return e==T&&!(this._kings[n]==R||this._kings[n]==o)?!1:(this._board[o]={type:e,color:n},e===T&&(this._kings[n]=o),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),!0)}remove(e){const n=this.get(e);return delete this._board[y[e]],n&&n.type===T&&(this._kings[n.color]=R),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),n}_updateCastlingRights(){var i,o,r,c,s,l,a,g,d,f,w,h;const e=((i=this._board[y.e1])==null?void 0:i.type)===T&&((o=this._board[y.e1])==null?void 0:o.color)===N,n=((r=this._board[y.e8])==null?void 0:r.type)===T&&((c=this._board[y.e8])==null?void 0:c.color)===F;(!e||((s=this._board[y.a1])==null?void 0:s.type)!==ge||((l=this._board[y.a1])==null?void 0:l.color)!==N)&&(this._castling.w&=~_.QSIDE_CASTLE),(!e||((a=this._board[y.h1])==null?void 0:a.type)!==ge||((g=this._board[y.h1])==null?void 0:g.color)!==N)&&(this._castling.w&=~_.KSIDE_CASTLE),(!n||((d=this._board[y.a8])==null?void 0:d.type)!==ge||((f=this._board[y.a8])==null?void 0:f.color)!==F)&&(this._castling.b&=~_.QSIDE_CASTLE),(!n||((w=this._board[y.h8])==null?void 0:w.type)!==ge||((h=this._board[y.h8])==null?void 0:h.color)!==F)&&(this._castling.b&=~_.KSIDE_CASTLE)}_updateEnPassantSquare(){var r,c;if(this._epSquare===R)return;const e=this._epSquare+(this._turn===N?-16:16),n=this._epSquare+(this._turn===N?16:-16),i=[n+1,n-1];if(this._board[e]!==null||this._board[this._epSquare]!==null||((r=this._board[n])==null?void 0:r.color)!==de(this._turn)||((c=this._board[n])==null?void 0:c.type)!==A){this._epSquare=R;return}const o=s=>{var l,a;return!(s&136)&&((l=this._board[s])==null?void 0:l.color)===this._turn&&((a=this._board[s])==null?void 0:a.type)===A};i.some(o)||(this._epSquare=R)}_attacked(e,n){for(let i=y.a8;i<=y.h1;i++){if(i&136){i+=7;continue}if(this._board[i]===void 0||this._board[i].color!==e)continue;const o=this._board[i],r=i-n;if(r===0)continue;const c=r+119;if(Hi[c]&Wi[o.type]){if(o.type===A){if(r>0){if(o.color===N)return!0}else if(o.color===F)return!0;continue}if(o.type==="n"||o.type==="k")return!0;const s=Ji[c];let l=i+s,a=!1;for(;l!==n;){if(this._board[l]!=null){a=!0;break}l+=s}if(!a)return!0}}return!1}_isKingAttacked(e){const n=this._kings[e];return n===-1?!1:this._attacked(de(e),n)}isAttacked(e,n){return this._attacked(n,y[e])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&this._moves().length===0}isStalemate(){return!this.isCheck()&&this._moves().length===0}isInsufficientMaterial(){const e={b:0,n:0,r:0,q:0,k:0,p:0},n=[];let i=0,o=0;for(let r=y.a8;r<=y.h1;r++){if(o=(o+1)%2,r&136){r+=7;continue}const c=this._board[r];c&&(e[c.type]=c.type in e?e[c.type]+1:1,c.type===Se&&n.push(o),i++)}if(i===2)return!0;if(i===3&&(e[Se]===1||e[Qe]===1))return!0;if(i===e[Se]+2){let r=0;const c=n.length;for(let s=0;s<c;s++)r+=n[s];if(r===0||r===c)return!0}return!1}isThreefoldRepetition(){const e=[],n={};let i=!1;for(;;){const o=this._undoMove();if(!o)break;e.push(o)}for(;;){const o=this.fen().split(" ").slice(0,4).join(" ");n[o]=o in n?n[o]+1:1,n[o]>=3&&(i=!0);const r=e.pop();if(r)this._makeMove(r);else break}return i}isDraw(){return this._halfMoves>=100||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isStalemate()||this.isDraw()}moves({verbose:e=!1,square:n=void 0,piece:i=void 0}={}){const o=this._moves({square:n,piece:i});return e?o.map(r=>this._makePretty(r)):o.map(r=>this._moveToSan(r,o))}_moves({legal:e=!0,piece:n=void 0,square:i=void 0}={}){var w;const o=i?i.toLowerCase():void 0,r=n==null?void 0:n.toLowerCase(),c=[],s=this._turn,l=de(s);let a=y.a8,g=y.h1,d=!1;if(o)if(o in y)a=g=y[o],d=!0;else return[];for(let h=a;h<=g;h++){if(h&136){h+=7;continue}if(!this._board[h]||this._board[h].color===l)continue;const{type:u}=this._board[h];let k;if(u===A){if(r&&r!==u)continue;k=h+Re[s][0],this._board[k]||($(c,s,h,k,A),k=h+Re[s][1],Xi[s]===ce(h)&&!this._board[k]&&$(c,s,h,k,A,void 0,_.BIG_PAWN));for(let m=2;m<4;m++)k=h+Re[s][m],!(k&136)&&(((w=this._board[k])==null?void 0:w.color)===l?$(c,s,h,k,A,this._board[k].type,_.CAPTURE):k===this._epSquare&&$(c,s,h,k,A,A,_.EP_CAPTURE))}else{if(r&&r!==u)continue;for(let m=0,P=_t[u].length;m<P;m++){const p=_t[u][m];for(k=h;k+=p,!(k&136);){if(!this._board[k])$(c,s,h,k,u);else{if(this._board[k].color===s)break;$(c,s,h,k,u,this._board[k].type,_.CAPTURE);break}if(u===Qe||u===T)break}}}}if((r===void 0||r===T)&&(!d||g===this._kings[s])){if(this._castling[s]&_.KSIDE_CASTLE){const h=this._kings[s],u=h+2;!this._board[h+1]&&!this._board[u]&&!this._attacked(l,this._kings[s])&&!this._attacked(l,h+1)&&!this._attacked(l,u)&&$(c,s,this._kings[s],u,T,void 0,_.KSIDE_CASTLE)}if(this._castling[s]&_.QSIDE_CASTLE){const h=this._kings[s],u=h-2;!this._board[h-1]&&!this._board[h-2]&&!this._board[h-3]&&!this._attacked(l,this._kings[s])&&!this._attacked(l,h-1)&&!this._attacked(l,u)&&$(c,s,this._kings[s],u,T,void 0,_.QSIDE_CASTLE)}}if(!e||this._kings[s]===-1)return c;const f=[];for(let h=0,u=c.length;h<u;h++)this._makeMove(c[h]),this._isKingAttacked(s)||f.push(c[h]),this._undoMove();return f}move(e,{strict:n=!1}={}){let i=null;if(typeof e=="string")i=this._moveFromSan(e,n);else if(typeof e=="object"){const r=this._moves();for(let c=0,s=r.length;c<s;c++)if(e.from===K(r[c].from)&&e.to===K(r[c].to)&&(!("promotion"in r[c])||e.promotion===r[c].promotion)){i=r[c];break}}if(!i)throw typeof e=="string"?new Error(`Invalid move: ${e}`):new Error(`Invalid move: ${JSON.stringify(e)}`);const o=this._makePretty(i);return this._makeMove(i),o}_push(e){this._history.push({move:e,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_makeMove(e){const n=this._turn,i=de(n);if(this._push(e),this._board[e.to]=this._board[e.from],delete this._board[e.from],e.flags&_.EP_CAPTURE&&(this._turn===F?delete this._board[e.to-16]:delete this._board[e.to+16]),e.promotion&&(this._board[e.to]={type:e.promotion,color:n}),this._board[e.to].type===T){if(this._kings[n]=e.to,e.flags&_.KSIDE_CASTLE){const o=e.to-1,r=e.to+1;this._board[o]=this._board[r],delete this._board[r]}else if(e.flags&_.QSIDE_CASTLE){const o=e.to+1,r=e.to-2;this._board[o]=this._board[r],delete this._board[r]}this._castling[n]=0}if(this._castling[n]){for(let o=0,r=X[n].length;o<r;o++)if(e.from===X[n][o].square&&this._castling[n]&X[n][o].flag){this._castling[n]^=X[n][o].flag;break}}if(this._castling[i]){for(let o=0,r=X[i].length;o<r;o++)if(e.to===X[i][o].square&&this._castling[i]&X[i][o].flag){this._castling[i]^=X[i][o].flag;break}}e.flags&_.BIG_PAWN?n===F?this._epSquare=e.to-16:this._epSquare=e.to+16:this._epSquare=R,e.piece===A?this._halfMoves=0:e.flags&(_.CAPTURE|_.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,n===F&&this._moveNumber++,this._turn=i}undo(){const e=this._undoMove();return e?this._makePretty(e):null}_undoMove(){const e=this._history.pop();if(e===void 0)return null;const n=e.move;this._kings=e.kings,this._turn=e.turn,this._castling=e.castling,this._epSquare=e.epSquare,this._halfMoves=e.halfMoves,this._moveNumber=e.moveNumber;const i=this._turn,o=de(i);if(this._board[n.from]=this._board[n.to],this._board[n.from].type=n.piece,delete this._board[n.to],n.captured)if(n.flags&_.EP_CAPTURE){let r;i===F?r=n.to-16:r=n.to+16,this._board[r]={type:A,color:o}}else this._board[n.to]={type:n.captured,color:o};if(n.flags&(_.KSIDE_CASTLE|_.QSIDE_CASTLE)){let r,c;n.flags&_.KSIDE_CASTLE?(r=n.to+1,c=n.to-1):(r=n.to-2,c=n.to+1),this._board[r]=this._board[c],delete this._board[c]}return n}pgn({newline:e=`
`,maxWidth:n=0}={}){const i=[];let o=!1;for(const f in this._header)i.push("["+f+' "'+this._header[f]+'"]'+e),o=!0;o&&this._history.length&&i.push(e);const r=f=>{const w=this._comments[this.fen()];if(typeof w<"u"){const h=f.length>0?" ":"";f=`${f}${h}{${w}}`}return f},c=[];for(;this._history.length>0;)c.push(this._undoMove());const s=[];let l="";for(c.length===0&&s.push(r(""));c.length>0;){l=r(l);const f=c.pop();if(!f)break;if(!this._history.length&&f.color==="b"){const w=`${this._moveNumber}. ...`;l=l?`${l} ${w}`:w}else f.color==="w"&&(l.length&&s.push(l),l=this._moveNumber+".");l=l+" "+this._moveToSan(f,this._moves({legal:!0})),this._makeMove(f)}if(l.length&&s.push(r(l)),typeof this._header.Result<"u"&&s.push(this._header.Result),n===0)return i.join("")+s.join(" ");const a=function(){return i.length>0&&i[i.length-1]===" "?(i.pop(),!0):!1},g=function(f,w){for(const h of w.split(" "))if(h){if(f+h.length>n){for(;a();)f--;i.push(e),f=0}i.push(h),f+=h.length,i.push(" "),f++}return a()&&f--,f};let d=0;for(let f=0;f<s.length;f++){if(d+s[f].length>n&&s[f].includes("{")){d=g(d,s[f]);continue}d+s[f].length>n&&f!==0?(i[i.length-1]===" "&&i.pop(),i.push(e),d=0):f!==0&&(i.push(" "),d++),i.push(s[f]),d+=s[f].length}return i.join("")}header(...e){for(let n=0;n<e.length;n+=2)typeof e[n]=="string"&&typeof e[n+1]=="string"&&(this._header[e[n]]=e[n+1]);return this._header}loadPgn(e,{strict:n=!1,newlineChar:i=`\r?
`}={}){function o(p){return p.replace(/\\/g,"\\")}function r(p){const S={},E=p.split(new RegExp(o(i)));let H="",J="";for(let C=0;C<E.length;C++){const L=/^\s*\[\s*([A-Za-z]+)\s*"(.*)"\s*\]\s*$/;H=E[C].replace(L,"$1"),J=E[C].replace(L,"$2"),H.trim().length>0&&(S[H]=J)}return S}e=e.trim();const s=new RegExp("^(\\[((?:"+o(i)+")|.)*\\])((?:\\s*"+o(i)+"){2}|(?:\\s*"+o(i)+")*$)").exec(e),l=s&&s.length>=2?s[1]:"";this.reset();const a=r(l);let g="";for(const p in a)p.toLowerCase()==="fen"&&(g=a[p]),this.header(p,a[p]);if(!n)g&&this.load(g,!0);else if(a.SetUp==="1"){if(!("FEN"in a))throw new Error("Invalid PGN: FEN tag must be supplied with SetUp tag");this.load(a.FEN,!0)}function d(p){return Array.from(p).map(function(S){return S.charCodeAt(0)<128?S.charCodeAt(0).toString(16):encodeURIComponent(S).replace(/%/g,"").toLowerCase()}).join("")}function f(p){return p.length==0?"":decodeURIComponent("%"+(p.match(/.{1,2}/g)||[]).join("%"))}const w=function(p){return p=p.replace(new RegExp(o(i),"g")," "),`{${d(p.slice(1,p.length-1))}}`},h=function(p){if(p.startsWith("{")&&p.endsWith("}"))return f(p.slice(1,p.length-1))};let u=e.replace(l,"").replace(new RegExp(`({[^}]*})+?|;([^${o(i)}]*)`,"g"),function(p,S,E){return S!==void 0?w(S):" "+w(`{${E.slice(1)}}`)}).replace(new RegExp(o(i),"g")," ");const k=/(\([^()]+\))+?/g;for(;k.test(u);)u=u.replace(k,"");u=u.replace(/\d+\.(\.\.)?/g,""),u=u.replace(/\.\.\./g,""),u=u.replace(/\$\d+/g,"");let m=u.trim().split(new RegExp(/\s+/));m=m.filter(p=>p!=="");let P="";for(let p=0;p<m.length;p++){const S=h(m[p]);if(S!==void 0){this._comments[this.fen()]=S;continue}const E=this._moveFromSan(m[p],n);if(E==null)if($i.indexOf(m[p])>-1)P=m[p];else throw new Error(`Invalid move in PGN: ${m[p]}`);else P="",this._makeMove(E)}P&&Object.keys(this._header).length&&!this._header.Result&&this.header("Result",P)}_moveToSan(e,n){let i="";if(e.flags&_.KSIDE_CASTLE)i="O-O";else if(e.flags&_.QSIDE_CASTLE)i="O-O-O";else{if(e.piece!==A){const o=to(e,n);i+=e.piece.toUpperCase()+o}e.flags&(_.CAPTURE|_.EP_CAPTURE)&&(e.piece===A&&(i+=K(e.from)[0]),i+="x"),i+=K(e.to),e.promotion&&(i+="="+e.promotion.toUpperCase())}return this._makeMove(e),this.isCheck()&&(this.isCheckmate()?i+="#":i+="+"),this._undoMove(),i}_moveFromSan(e,n=!1){const i=Ke(e);let o=kt(i),r=this._moves({legal:!0,piece:o});for(let f=0,w=r.length;f<w;f++)if(i===Ke(this._moveToSan(r[f],r)))return r[f];if(n)return null;let c,s,l,a,g,d=!1;if(s=i.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/),s?(c=s[1],l=s[2],a=s[3],g=s[4],l.length==1&&(d=!0)):(s=i.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/),s&&(c=s[1],l=s[2],a=s[3],g=s[4],l.length==1&&(d=!0))),o=kt(i),r=this._moves({legal:!0,piece:c||o}),!a)return null;for(let f=0,w=r.length;f<w;f++)if(l){if((!c||c.toLowerCase()==r[f].piece)&&y[l]==r[f].from&&y[a]==r[f].to&&(!g||g.toLowerCase()==r[f].promotion))return r[f];if(d){const h=K(r[f].from);if((!c||c.toLowerCase()==r[f].piece)&&y[a]==r[f].to&&(l==h[0]||l==h[1])&&(!g||g.toLowerCase()==r[f].promotion))return r[f]}}else if(i===Ke(this._moveToSan(r[f],r)).replace("x",""))return r[f];return null}ascii(){let e=`   +------------------------+
`;for(let n=y.a8;n<=y.h1;n++){if(_e(n)===0&&(e+=" "+"87654321"[ce(n)]+" |"),this._board[n]){const i=this._board[n].type,r=this._board[n].color===N?i.toUpperCase():i.toLowerCase();e+=" "+r+" "}else e+=" . ";n+1&136&&(e+=`|
`,n+=8)}return e+=`   +------------------------+
`,e+="     a  b  c  d  e  f  g  h",e}perft(e){const n=this._moves({legal:!1});let i=0;const o=this._turn;for(let r=0,c=n.length;r<c;r++)this._makeMove(n[r]),this._isKingAttacked(o)||(e-1>0?i+=this.perft(e-1):i++),this._undoMove();return i}_makePretty(e){const{color:n,piece:i,from:o,to:r,flags:c,captured:s,promotion:l}=e;let a="";for(const w in _)_[w]&c&&(a+=Qi[w]);const g=K(o),d=K(r),f={color:n,piece:i,from:g,to:d,san:this._moveToSan(e,this._moves({legal:!0})),flags:a,lan:g+d,before:this.fen(),after:""};return this._makeMove(e),f.after=this.fen(),this._undoMove(),s&&(f.captured=s),l&&(f.promotion=l,f.lan+=l),f}turn(){return this._turn}board(){const e=[];let n=[];for(let i=y.a8;i<=y.h1;i++)this._board[i]==null?n.push(null):n.push({square:K(i),type:this._board[i].type,color:this._board[i].color}),i+1&136&&(e.push(n),n=[],i+=8);return e}squareColor(e){if(e in y){const n=y[e];return(ce(n)+_e(n))%2===0?"light":"dark"}return null}history({verbose:e=!1}={}){const n=[],i=[];for(;this._history.length>0;)n.push(this._undoMove());for(;;){const o=n.pop();if(!o)break;e?i.push(this._makePretty(o)):i.push(this._moveToSan(o,this._moves())),this._makeMove(o)}return i}_pruneComments(){const e=[],n={},i=o=>{o in this._comments&&(n[o]=this._comments[o])};for(;this._history.length>0;)e.push(this._undoMove());for(i(this.fen());;){const o=e.pop();if(!o)break;this._makeMove(o),i(this.fen())}this._comments=n}getComment(){return this._comments[this.fen()]}setComment(e){this._comments[this.fen()]=e.replace("{","[").replace("}","]")}deleteComment(){const e=this._comments[this.fen()];return delete this._comments[this.fen()],e}getComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>({fen:e,comment:this._comments[e]}))}deleteComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>{const n=this._comments[e];return delete this._comments[e],{fen:e,comment:n}})}setCastlingRights(e,n){for(const o of[T,te])n[o]!==void 0&&(n[o]?this._castling[e]|=ke[o]:this._castling[e]&=~ke[o]);this._updateCastlingRights();const i=this.getCastlingRights(e);return(n[T]===void 0||n[T]===i[T])&&(n[te]===void 0||n[te]===i[te])}getCastlingRights(e){return{[T]:(this._castling[e]&ke[T])!==0,[te]:(this._castling[e]&ke[te])!==0}}moveNumber(){return this._moveNumber}};class B{constructor(e,n="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",i=a=>{},o=async a=>"q",r=a=>{},c=a=>{},s="w",l=void 0){x(this,"chessJS");x(this,"gameIsOver",!1);x(this,"initialised",!1);this.cg=e,this.stateChangeCallback=i,this.promotionCallback=o,this.moveCallback=r,this.gameOverCallback=c,this._orientation=s,this.engine=l,this.cg.set({fen:n,orientation:B._colorToCgColor(s),movable:{free:!1},premovable:{enabled:!1}}),this.chessJS=new no(n),this.load(n)}async init(){this.engine&&await this.engine.init().then(()=>{this._enginePlaysNextMove()&&this.playEngineMove()}),this.initialised=!0}load(e){var r;let n;this.initialised&&((r=this.engine)!=null&&r.isSearching())&&(n=this.engine.stopSearch()),this.chessJS.load(e),this._checkForGameOver(),this.cg.set({animation:{enabled:!1}});const i=B._colorToCgColor(this.chessJS.turn()),o=this._enginePlaysNextMove();this.cg.set({fen:e,turnColor:i,check:this.chessJS.inCheck(),lastMove:void 0,selected:void 0,movable:{free:!1,color:i,dests:o?new Map:this.possibleMovesDests(),events:{after:(c,s)=>{this._chessgroundMoveCallback(c,s)}}}}),this.cg.set({animation:{enabled:!0}}),this.initialised&&o&&(n?n.then(()=>{this.playEngineMove()}):this.playEngineMove()),this.stateChangeCallback(this)}async _chessgroundMoveCallback(e,n){if(e==="a0"||n==="a0")throw Error("invalid square");this.engine&&this.engine.isSearching()&&this.engine.stopSearch();let i;if(this._moveIsPromotion(e,n)){const r=await this.promotionCallback(n);i=this.chessJS.move({from:e,to:n,promotion:r})}else i=this.chessJS.move({from:e,to:n});const o=B._cjsMoveToMove(i);this._postMoveAdmin(o)}_moveIsPromotion(e,n){return this.chessJS.get(e).type==="p"&&(n.charAt(1)=="1"||n.charAt(1)=="8")}move(e){if(!this.initialised)throw new Error("Called move before initialisation finished.");if(this.gameIsOver)throw new Error("Invalid move: Game is over.");this.engine&&this.engine.isSearching()&&this.engine.stopSearch();const n=this.chessJS.move(e),i=B._cjsMoveToMove(n);this.cg.move(i.from,i.to),this.cg.set({turnColor:B._colorToCgColor(this.chessJS.turn())}),this._postMoveAdmin(i)}moveLan(e){const n=e.slice(0,2),i=e.slice(2,4),o=e.charAt(4)||void 0;this.move({from:n,to:i,promotion:o})}_postMoveAdmin(e){const n=this._enginePlaysNextMove();(e.flags.includes("e")||e.flags.includes("p"))&&this.cg.set({fen:this.chessJS.fen()}),e.check&&this.cg.set({check:!0}),this.moveCallback(e),this._checkForGameOver(),n?this.cg.set({movable:{dests:new Map}}):this._updateChessgroundWithPossibleMoves(),this.stateChangeCallback(this),!this.gameIsOver&&n&&this.playEngineMove()}async playEngineMove(){if(!this.engine)throw new Error("playEngineMove called without initialised engine");return this.engine.getMove(this.chessJS.fen()).then(e=>{this.moveLan(e)})}_enginePlaysNextMove(){return this.engine&&(this.engine.getColor()==="both"||this.engine.getColor()===this.chessJS.turn())}_updateChessgroundWithPossibleMoves(){const e=B._colorToCgColor(this.chessJS.turn());this.cg.set({turnColor:e,movable:{color:e,dests:this.possibleMovesDests()}})}_checkForGameOver(){if(this.chessJS.isCheckmate()){const e=this.chessJS.turn()=="w"?0:1;this.gameOverCallback({reason:"checkmate",result:e}),this.gameIsOver=!0}else this.chessJS.isStalemate()?(this.gameOverCallback({reason:"stalemate",result:.5}),this.gameIsOver=!0):this.chessJS.isInsufficientMaterial()?(this.gameOverCallback({reason:"insufficient material",result:.5}),this.gameIsOver=!0):this.chessJS.isThreefoldRepetition()?(this.gameOverCallback({reason:"repetition",result:.5}),this.gameIsOver=!0):this.chessJS.isDraw()?(this.gameOverCallback({reason:"fifty-move rule",result:.5}),this.gameIsOver=!0):this.gameIsOver=!1}possibleMovesDests(){const e=new Map;return this.gameIsOver||Ui.forEach(n=>{const i=this.chessJS.moves({square:n,verbose:!0});i.length&&e.set(n,i.map(o=>o.to))}),e}reset(){this.load("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1")}undo(){const e=this.chessJS.undo(),n=e?B._cjsMoveToMove(e):null;return this.cg.set({fen:this.chessJS.fen(),turnColor:B._colorToCgColor(this.chessJS.turn()),lastMove:void 0}),this.gameIsOver=!1,this._updateChessgroundWithPossibleMoves(),this.stateChangeCallback(this),n}toggleOrientation(){this._orientation=this._orientation==="w"?"b":"w",this.cg.set({orientation:B._colorToCgColor(this._orientation)}),this.stateChangeCallback(this)}orientation(){return this._orientation}isGameOver(){return this.gameIsOver}fen(){return this.chessJS.fen()}turn(){return this.chessJS.turn()}moveNumber(){return this.chessJS.moveNumber()}inCheck(){return this.chessJS.inCheck()}history({verbose:e=!1}={}){return e?this.chessJS.history({verbose:e}).map(B._cjsMoveToMove):this.chessJS.history({verbose:e})}board(){return this.chessJS.board()}static _colorToCgColor(e){return e==="w"?"white":"black"}static _cgColorToColor(e){return e==="white"?"w":"b"}static _cjsMoveToMove(e){const n=e.san.slice(-1),i=n==="#";return{...e,check:n==="+"||i,checkmate:i}}}function io(t){let e,n,i,o={class:t[0]};return n=new Li({props:o}),t[19](n),{c(){e=pe("div"),pn(n.$$.fragment),this.h()},l(r){e=me(r,"DIV",{style:!0});var c=be(e);mn(n.$$.fragment,c),c.forEach(z),this.h()},h(){ye(e,"position","relative")},m(r,c){Me(r,e,c),bn(n,e,null),t[20](e),i=!0},p(r,[c]){const s={};c&1&&(s.class=r[0]),n.$set(s)},i(r){i||(vn(n.$$.fragment,r),i=!0)},o(r){_n(n.$$.fragment,r),i=!1},d(r){r&&z(e),t[19](null),wn(n),t[20](null)}}}function oo(t,e,n){const i=kn();let o,r,{moveNumber:c=0}=e,{turn:s="w"}=e,{inCheck:l=!1}=e,{history:a=[]}=e,{isGameOver:g=!1}=e,{fen:d="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1"}=e,{orientation:f="w"}=e,{engine:w=void 0}=e,{class:h=void 0}=e,u;function k(v){if(!u)throw new Error("component not mounted yet");u.load(v)}function m(v){if(!u)throw new Error("component not mounted yet");u.move(v)}function P({verbose:v=!1}={}){if(!u)throw new Error("component not mounted yet");return u.history({verbose:v})}function p(){if(!u)throw new Error("component not mounted yet");return u.board()}function S(){if(!u)throw new Error("component not mounted yet");return u.undo()}function E(){if(!u)throw new Error("component not mounted yet");u.reset()}function H(){if(!u)throw new Error("component not mounted yet");u.toggleOrientation()}async function J(){if(!u)throw new Error("component not mounted yet");return u.playEngineMove()}function C(v){n(8,d=v.fen()),n(9,f=v.orientation()),n(3,c=v.moveNumber()),n(4,s=v.turn()),n(5,l=v.inCheck()),n(6,a=v.history()),n(7,g=v.isGameOver())}function L(v){return new Promise(Te=>{const Ne=new ji({target:r,props:{square:v,orientation:f,callback:Oe=>{Ne.$destroy(),Te(Oe)}}})})}function O(v){i("move",v)}function I(v){i("gameOver",v)}yt(async()=>{u=new B(o,d,C,L,O,I,f,w),u.init().then(()=>{i("ready")})});function Z(v){Le[v?"unshift":"push"](()=>{o=v,n(1,o)})}function Ae(v){Le[v?"unshift":"push"](()=>{r=v,n(2,r)})}return t.$$set=v=>{"moveNumber"in v&&n(3,c=v.moveNumber),"turn"in v&&n(4,s=v.turn),"inCheck"in v&&n(5,l=v.inCheck),"history"in v&&n(6,a=v.history),"isGameOver"in v&&n(7,g=v.isGameOver),"fen"in v&&n(8,d=v.fen),"orientation"in v&&n(9,f=v.orientation),"engine"in v&&n(10,w=v.engine),"class"in v&&n(0,h=v.class)},[h,o,r,c,s,l,a,g,d,f,w,k,m,P,p,S,E,H,J,Z,Ae]}class ao extends Ue{constructor(e){super(),He(this,e,oo,io,Je,{moveNumber:3,turn:4,inCheck:5,history:6,isGameOver:7,fen:8,orientation:9,engine:10,class:0,load:11,move:12,getHistory:13,getBoard:14,undo:15,reset:16,toggleOrientation:17,playEngineMove:18})}get load(){return this.$$.ctx[11]}get move(){return this.$$.ctx[12]}get getHistory(){return this.$$.ctx[13]}get getBoard(){return this.$$.ctx[14]}get undo(){return this.$$.ctx[15]}get reset(){return this.$$.ctx[16]}get toggleOrientation(){return this.$$.ctx[17]}get playEngineMove(){return this.$$.ctx[18]}}export{ao as C};
